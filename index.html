<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Team Calendar</title>
    <meta name="description" content="Professional team resource calendar with data sync">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- PWA Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Team Calendar">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGVhbSBDYWxlbmRhciIsInNob3J0X25hbWUiOiJUZWFtQ2FsIiwiZGVzY3JpcHRpb24iOiJQcm9mZXNzaW9uYWwgdGVhbSByZXNvdXJjZSBjYWxlbmRhciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjM2I4MmY2Iiwib3JpZW50YXRpb24iOiJwb3J0cmFpdCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlTU0l3SURBZ01qVTJJREkxTmlKZ1ptbHNiRDBpSXpNeU9EZG1OaUkrUEhKbFkzUWdlRDBpTkRnaUlIazlJalE0SWlCM2FXUjBhRDBpTVRZd0lpQm9aV2xuYUhROUlqRTJNQ0lnWm1sc2JEMGlJelEzT0RBME1DSXZQand2YzNabmZqND0iLCJzaXplcyI6IjI1NngyNTYiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCIsInB1cnBvc2UiOiJtYXNrYWJsZSJ9XX0=">
    
    <style>
        /* CSS Variables for Easy Customization */
        :root {
            --primary-blue: #3b82f6;
            --primary-hover: #2563eb;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --border-radius: 8px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--white);
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        /* Header Styles */
        .app-header {
            background: var(--white);
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .icon-button {
            background: none;
            border: none;
            padding: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            min-height: 40px;
        }

        .icon-button:hover {
            background-color: var(--gray-100);
        }

        .icon-button:active {
            background-color: var(--gray-200);
            transform: scale(0.95);
        }

        .sync-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--gray-100);
            border-radius: 12px;
            font-size: 11px;
            color: var(--gray-600);
        }

        .sync-indicator.syncing {
            background: #fef3c7;
            color: #92400e;
        }

        .sync-indicator.synced {
            background: #dcfce7;
            color: #166534;
        }

        .sync-indicator.error {
            background: #fee2e2;
            color: #dc2626;
        }

        .month-navigation {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .month-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            min-width: 160px;
            text-align: center;
        }

        .member-info-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-top: 1px solid var(--gray-200);
        }

        .avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .member-details h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .member-details p {
            font-size: 12px;
            color: var(--gray-500);
            margin: 0;
        }

        /* Main Content */
        .main-content {
            padding: 16px;
            min-height: calc(100vh - 200px);
        }

        .page-title {
            text-align: center;
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 16px;
        }

        /* Today's Jobs Card */
        .todays-jobs-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 16px 12px;
            border-bottom: 1px solid var(--gray-100);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .job-count-badge {
            background: var(--primary-blue);
            color: var(--white);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .jobs-list {
            max-height: 240px;
            overflow-y: auto;
            padding: 8px 16px 16px;
        }

        .job-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .job-item:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .job-item:active {
            transform: scale(0.98);
        }

        .job-item.on-call {
            border-color: #fca5a5;
            background: #fef2f2;
        }

        .job-content {
            flex: 1;
            min-width: 0;
        }

        .job-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
            flex-wrap: wrap;
        }

        .job-type-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid;
        }

        .priority-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .priority-high { background: #fef2f2; color: #dc2626; }
        .priority-medium { background: #fef3c7; color: #d97706; }
        .priority-low { background: #ecfdf5; color: #059669; }

        .job-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .job-member {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 2px;
        }

        .job-client {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .job-duration {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--gray-500);
        }

        .empty-jobs {
            text-align: center;
            padding: 32px 16px;
            color: var(--gray-500);
        }

        .empty-jobs-icon {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        /* Team Cards */
        .team-members {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .team-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .team-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .team-card:active {
            transform: scale(0.98);
        }

        .team-card-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 14px;
            font-weight: 700;
        }

        .team-details h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0 0 2px 0;
        }

        .team-details p {
            font-size: 12px;
            color: var(--gray-500);
            margin: 0;
        }

        .task-counter {
            text-align: right;
        }

        .task-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-700);
            line-height: 1;
        }

        .task-label {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Workload Bar */
        .workload-visualization {
            display: flex;
            gap: 1px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .workload-day {
            flex: 1;
            min-width: 2px;
            position: relative;
        }

        .today-indicator {
            position: absolute;
            inset: -2px;
            border: 2px solid var(--primary-blue);
            border-radius: 4px;
        }

        /* Individual Calendar */
        .calendar-section {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow);
            margin-top: 16px;
        }

        .week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .week-day {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            padding: 8px 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            height: 52px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            padding: 2px;
            position: relative;
            background: var(--white);
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .calendar-day:hover {
            background: var(--gray-50);
            box-shadow: var(--shadow);
        }

        .calendar-day.weekend {
            background: var(--gray-50);
        }

        .calendar-day.today {
            border: 2px solid var(--primary-blue);
            background: #eff6ff;
        }

        .day-number {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
            color: var(--gray-600);
            font-weight: 600;
        }

        .today .day-number {
            background: var(--primary-blue);
            color: var(--white);
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 9px;
        }

        .day-jobs {
            margin-top: 14px;
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .mini-job {
            padding: 1px 3px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: 600;
            border: 1px solid;
            cursor: pointer;
            transition: opacity 0.2s;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .mini-job:hover {
            opacity: 0.8;
        }

        .more-jobs {
            font-size: 7px;
            color: var(--gray-500);
            text-align: center;
            cursor: pointer;
        }

        /* Job Type Colors */
        .job-design { 
            background: #dbeafe; 
            color: #1e40af; 
            border-color: #93c5fd; 
        }
        .job-development { 
            background: #dcfce7; 
            color: #166534; 
            border-color: #86efac; 
        }
        .job-testing { 
            background: #fef3c7; 
            color: #92400e; 
            border-color: #fde047; 
        }
        .job-meeting { 
            background: #e9d5ff; 
            color: #7c3aed; 
            border-color: #c4b5fd; 
        }
        .job-review { 
            background: #fed7aa; 
            color: #c2410c; 
            border-color: #fdba74; 
        }
        .job-planning { 
            background: #fce7f3; 
            color: #be185d; 
            border-color: #f9a8d4; 
        }
        .job-on-call { 
            background: #fee2e2; 
            color: #dc2626; 
            border-color: #fca5a5; 
        }

        /* Member Colors */
        .member-blue { background-color: var(--primary-blue); }
        .member-green { background-color: var(--success-green); }
        .member-purple { background-color: #8b5cf6; }
        .member-yellow { background-color: var(--warning-orange); }
        .member-pink { background-color: #ec4899; }
        .member-orange { background-color: #f97316; }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 0;
        }

        .modal {
            background: var(--white);
            border-radius: 16px 16px 0 0;
            width: 100%;
            max-width: 428px;
            max-height: 85vh;
            overflow: hidden;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .modal.show {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .modal-body {
            padding: 16px;
            overflow-y: auto;
            max-height: calc(85vh - 80px);
        }

        /* Member Selection */
        .member-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .member-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .member-option:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .member-option:active {
            transform: scale(0.98);
        }

        .member-option.selected {
            background: #eff6ff;
            border-color: var(--primary-blue);
        }

        /* Settings */
        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 12px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: border-color 0.2s ease;
            background: var(--white);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-help {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 0;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-blue);
        }

        .primary-button, .secondary-button, .danger-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }

        .primary-button {
            background: var(--primary-blue);
            color: var(--white);
        }

        .primary-button:hover {
            background: var(--primary-hover);
        }

        .primary-button:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
        }

        .secondary-button {
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .secondary-button:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .danger-button {
            background: var(--error-red);
            color: var(--white);
        }

        .danger-button:hover {
            background: #dc2626;
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--border-radius);
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 16px;
        }

        .file-upload-area:hover {
            border-color: var(--primary-blue);
            background: var(--gray-50);
        }

        .file-upload-area.dragover {
            border-color: var(--primary-blue);
            background: #eff6ff;
        }

        .file-upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .file-upload-text {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .file-upload-hint {
            font-size: 12px;
            color: var(--gray-500);
        }

        .file-input {
            display: none;
        }

        /* Legend */
        .legend {
            background: var(--white);
            padding: 16px;
            border-top: 1px solid var(--gray-200);
        }

        .legend-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .legend-item {
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            border: 1px solid;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            left: 16px;
            right: 16px;
            max-width: 400px;
            margin: 0 auto;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 600;
            z-index: 2000;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
        }

        .toast-success { background: var(--success-green); color: var(--white); }
        .toast-error { background: var(--error-red); color: var(--white); }
        .toast-info { background: var(--primary-blue); color: var(--white); }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Data Status */
        .data-status {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 12px;
            margin-bottom: 16px;
            font-size: 12px;
        }

        .data-status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .data-status-row:last-child {
            margin-bottom: 0;
        }

        .data-status-label {
            color: var(--gray-600);
        }

        .data-status-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Responsive Design */
        @media (max-width: 375px) {
            .app-container {
                max-width: 100%;
            }
            .main-content {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-row">
                <button class="icon-button" id="menuButton" aria-label="Open menu">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>
                
                <nav class="month-navigation">
                    <button class="icon-button" id="prevButton" aria-label="Previous month">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <h1 class="month-title" id="monthTitle">September 2025</h1>
                    <button class="icon-button" id="nextButton" aria-label="Next month">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                </nav>
                
                <button class="icon-button" id="settingsButton" aria-label="Open settings">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>
            
            <div class="sync-indicator" id="syncIndicator">
                <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                </svg>
                <span id="syncStatus">Local Storage</span>
            </div>
            
            <div class="member-info-bar hidden" id="memberInfoBar">
                <div class="avatar member-blue" id="selectedAvatar">SM</div>
                <div class="member-details">
                    <h3 id="selectedName">Sarah Martinez</h3>
                    <p id="selectedRole">UI/UX Designer</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Team Overview -->
            <div id="teamOverview">
                <div class="page-title">
                    Team Overview - Select a member for detailed view
                </div>
                
                <!-- Today's Jobs Card -->
                <div class="todays-jobs-card">
                    <div class="card-header">
                        <h2 class="card-title">üìÖ Today's Scheduled Jobs</h2>
                        <div class="job-count-badge" id="todayJobCount">0</div>
                    </div>
                    <div class="jobs-list" id="todayJobsList">
                        <!-- Jobs populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Team Members -->
                <h2 style="font-size: 18px; font-weight: 700; color: var(--gray-800); margin: 16px 0 12px;">Team Members</h2>
                <div class="team-members" id="teamMembersList">
                    <!-- Team members populated by JavaScript -->
                </div>
            </div>
            
            <!-- Individual Calendar -->
            <div id="individualCalendar" class="hidden">
                <!-- Today's Jobs for Member -->
                <div class="todays-jobs-card">
                    <div class="card-header">
                        <h2 class="card-title" id="memberTodayTitle">üìã Today's Schedule</h2>
                        <div class="job-count-badge" id="memberJobCount">0</div>
                    </div>
                    <div class="jobs-list" id="memberTodayJobs">
                        <!-- Member's jobs populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Calendar Grid -->
                <div class="calendar-section">
                    <div class="week-days">
                        <div class="week-day">S</div>
                        <div class="week-day">M</div>
                        <div class="week-day">T</div>
                        <div class="week-day">W</div>
                        <div class="week-day">T</div>
                        <div class="week-day">F</div>
                        <div class="week-day">S</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar days populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Legend -->
        <footer class="legend">
            <h3 class="legend-title">Job Types</h3>
            <div class="legend-grid">
                <div class="legend-item job-design">Design</div>
                <div class="legend-item job-development">Development</div>
                <div class="legend-item job-testing">Testing</div>
                <div class="legend-item job-meeting">Meeting</div>
                <div class="legend-item job-review">Review</div>
                <div class="legend-item job-planning">Planning</div>
                <div class="legend-item job-on-call">On-Call</div>
            </div>
        </footer>
    </div>

    <!-- Member Selection Modal -->
    <div class="modal-overlay hidden" id="memberModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Select Team Member</h2>
                <button class="icon-button" id="closeMemberModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="member-list" id="memberList">
                    <!-- Members populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay hidden" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Settings & Data Management</h2>
                <button class="icon-button" id="closeSettingsModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3 class="section-title">Data Storage</h3>
                    <div class="data-status">
                        <div class="data-status-row">
                            <span class="data-status-label">Storage Type:</span>
                            <span class="data-status-value" id="storageType">IndexedDB</span>
                        </div>
                        <div class="data-status-row">
                            <span class="data-status-label">Team Members:</span>
                            <span class="data-status-value" id="memberCount">0</span>
                        </div>
                        <div class="data-status-row">
                            <span class="data-status-label">Total Jobs:</span>
                            <span class="data-status-value" id="jobCount">0</span>
                        </div>
                        <div class="data-status-row">
                            <span class="data-status-label">Last Updated:</span>
                            <span class="data-status-value" id="lastUpdated">Never</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">Import Data</h3>
                    <div class="file-upload-area" id="fileUploadArea">
                        <div class="file-upload-icon">üìÅ</div>
                        <div class="file-upload-text">Click to upload or drag and drop</div>
                        <div class="file-upload-hint">JSON, CSV, or Excel files</div>
                    </div>
                    <input type="file" id="fileInput" class="file-input" accept=".json,.csv,.xlsx,.xls">
                    
                    <div class="form-group">
                        <label class="form-label">Quick Import</label>
                        <button class="secondary-button" id="loadSampleData">Load Sample Data</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">Export Data</h3>
                    <button class="secondary-button" id="exportJSON">Export as JSON</button>
                    <button class="secondary-button" id="exportCSV">Export as CSV</button>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">Sync Options</h3>
                    <div class="form-group">
                        <label class="form-label" for="syncMethod">Sync Method</label>
                        <select id="syncMethod" class="form-select">
                            <option value="local">Local Storage Only</option>
                            <option value="google">Google Sheets</option>
                            <option value="api">Custom API</option>
                        </select>
                    </div>
                    
                    <div id="googleSheetsConfig" class="hidden">
                        <div class="form-group">
                            <label class="form-label" for="sheetId">Google Sheet ID</label>
                            <input type="text" id="sheetId" class="form-input" placeholder="Sheet ID from URL">
                            <small class="form-help">Get this from your Google Sheet URL</small>
                        </div>
                        <button class="secondary-button" id="authorizeGoogle">Authorize Google Sheets</button>
                    </div>
                    
                    <div id="apiConfig" class="hidden">
                        <div class="form-group">
                            <label class="form-label" for="apiUrl">API Endpoint</label>
                            <input type="text" id="apiUrl" class="form-input" placeholder="https://api.example.com/calendar">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="apiKey">API Key</label>
                            <input type="password" id="apiKey" class="form-input" placeholder="Your API key">
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">Preferences</h3>
                    <label class="checkbox-group">
                        <input type="checkbox" id="autoSync" class="checkbox" checked>
                        <span>Auto-sync every 5 minutes</span>
                    </label>
                    <label class="checkbox-group">
                        <input type="checkbox" id="notifications" class="checkbox">
                        <span>Enable notifications</span>
                    </label>
                    <label class="checkbox-group">
                        <input type="checkbox" id="offlineMode" class="checkbox" checked>
                        <span>Enable offline mode</span>
                    </label>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">Data Management</h3>
                    <button class="danger-button" id="clearData">Clear All Data</button>
                </div>

                <button class="primary-button" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div class="modal-overlay hidden" id="jobModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Job Details</h2>
                <button class="icon-button" id="closeJobModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="jobDetails">
                <!-- Job details populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Job Modal -->
    <div class="modal-overlay hidden" id="editJobModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="editJobTitle">Add Job</h2>
                <button class="icon-button" id="closeEditJobModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="jobForm">
                    <div class="form-group">
                        <label class="form-label" for="jobTitle">Title</label>
                        <input type="text" id="jobTitleInput" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobType">Type</label>
                        <select id="jobType" class="form-select" required>
                            <option value="design">Design</option>
                            <option value="development">Development</option>
                            <option value="testing">Testing</option>
                            <option value="meeting">Meeting</option>
                            <option value="review">Review</option>
                            <option value="planning">Planning</option>
                            <option value="on-call">On-Call</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobMember">Assign To</label>
                        <select id="jobMember" class="form-select" required>
                            <!-- Populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobDate">Date</label>
                        <input type="date" id="jobDate" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobDuration">Duration</label>
                        <select id="jobDuration" class="form-select" required>
                            <option value="full">Full Day (8 hours)</option>
                            <option value="half">Half Day (4 hours)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobPriority">Priority</label>
                        <select id="jobPriority" class="form-select" required>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobClient">Client</label>
                        <input type="text" id="jobClient" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobDescription">Description</label>
                        <textarea id="jobDescription" class="form-input" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="jobNotes">Notes</label>
                        <textarea id="jobNotes" class="form-input" rows="2"></textarea>
                    </div>
                    
                    <button type="submit" class="primary-button">Save Job</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Database Module - IndexedDB for robust local storage
        const Database = {
            db: null,
            dbName: 'TeamCalendarDB',
            version: 1,
            
            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Create stores
                        if (!db.objectStoreNames.contains('teamMembers')) {
                            const memberStore = db.createObjectStore('teamMembers', { keyPath: 'id', autoIncrement: true });
                            memberStore.createIndex('name', 'name', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('jobAssignments')) {
                            const jobStore = db.createObjectStore('jobAssignments', { keyPath: 'id', autoIncrement: true });
                            jobStore.createIndex('memberId', 'memberId', { unique: false });
                            jobStore.createIndex('date', 'date', { unique: false });
                            jobStore.createIndex('month', 'month', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('settings')) {
                            db.createObjectStore('settings', { keyPath: 'key' });
                        }
                    };
                });
            },
            
            async getTeamMembers() {
                const transaction = this.db.transaction(['teamMembers'], 'readonly');
                const store = transaction.objectStore('teamMembers');
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async addTeamMember(member) {
                const transaction = this.db.transaction(['teamMembers'], 'readwrite');
                const store = transaction.objectStore('teamMembers');
                return new Promise((resolve, reject) => {
                    const request = store.add(member);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async updateTeamMember(member) {
                const transaction = this.db.transaction(['teamMembers'], 'readwrite');
                const store = transaction.objectStore('teamMembers');
                return new Promise((resolve, reject) => {
                    const request = store.put(member);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async deleteTeamMember(id) {
                const transaction = this.db.transaction(['teamMembers'], 'readwrite');
                const store = transaction.objectStore('teamMembers');
                return new Promise((resolve, reject) => {
                    const request = store.delete(id);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async getJobAssignments(month = null) {
                const transaction = this.db.transaction(['jobAssignments'], 'readonly');
                const store = transaction.objectStore('jobAssignments');
                
                return new Promise((resolve, reject) => {
                    let request;
                    if (month) {
                        const index = store.index('month');
                        request = index.getAll(month);
                    } else {
                        request = store.getAll();
                    }
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async addJobAssignment(job) {
                const transaction = this.db.transaction(['jobAssignments'], 'readwrite');
                const store = transaction.objectStore('jobAssignments');
                return new Promise((resolve, reject) => {
                    const request = store.add(job);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async updateJobAssignment(job) {
                const transaction = this.db.transaction(['jobAssignments'], 'readwrite');
                const store = transaction.objectStore('jobAssignments');
                return new Promise((resolve, reject) => {
                    const request = store.put(job);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async deleteJobAssignment(id) {
                const transaction = this.db.transaction(['jobAssignments'], 'readwrite');
                const store = transaction.objectStore('jobAssignments');
                return new Promise((resolve, reject) => {
                    const request = store.delete(id);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async getSetting(key) {
                const transaction = this.db.transaction(['settings'], 'readonly');
                const store = transaction.objectStore('settings');
                return new Promise((resolve, reject) => {
                    const request = store.get(key);
                    request.onsuccess = () => resolve(request.result?.value);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async setSetting(key, value) {
                const transaction = this.db.transaction(['settings'], 'readwrite');
                const store = transaction.objectStore('settings');
                return new Promise((resolve, reject) => {
                    const request = store.put({ key, value });
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async clearAllData() {
                const transaction = this.db.transaction(['teamMembers', 'jobAssignments', 'settings'], 'readwrite');
                
                return Promise.all([
                    new Promise((resolve, reject) => {
                        const request = transaction.objectStore('teamMembers').clear();
                        request.onsuccess = () => resolve();
                        request.onerror = () => reject(request.error);
                    }),
                    new Promise((resolve, reject) => {
                        const request = transaction.objectStore('jobAssignments').clear();
                        request.onsuccess = () => resolve();
                        request.onerror = () => reject(request.error);
                    }),
                    new Promise((resolve, reject) => {
                        const request = transaction.objectStore('settings').clear();
                        request.onsuccess = () => resolve();
                        request.onerror = () => reject(request.error);
                    })
                ]);
            }
        };

        // Data Import/Export Module
        const DataManager = {
            async exportToJSON() {
                const members = await Database.getTeamMembers();
                const jobs = await Database.getJobAssignments();
                const settings = {
                    syncMethod: await Database.getSetting('syncMethod'),
                    autoSync: await Database.getSetting('autoSync'),
                    notifications: await Database.getSetting('notifications'),
                    offlineMode: await Database.getSetting('offlineMode')
                };
                
                const data = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    teamMembers: members,
                    jobAssignments: jobs,
                    settings: settings
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `team-calendar-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            },
            
            async exportToCSV() {
                const jobs = await Database.getJobAssignments();
                const members = await Database.getTeamMembers();
                
                // Create member lookup
                const memberLookup = {};
                members.forEach(m => memberLookup[m.id] = m.name);
                
                // CSV headers
                let csv = 'Date,Member,Title,Type,Duration,Priority,Client,Description,Notes,Status\n';
                
                // Add job rows
                jobs.forEach(job => {
                    const row = [
                        job.date,
                        memberLookup[job.memberId] || 'Unknown',
                        job.title,
                        job.type,
                        job.duration,
                        job.priority,
                        job.client,
                        `"${(job.description || '').replace(/"/g, '""')}"`,
                        `"${(job.notes || '').replace(/"/g, '""')}"`,
                        job.status || 'Scheduled'
                    ];
                    csv += row.join(',') + '\n';
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `team-calendar-jobs-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            },
            
            async importFromJSON(jsonData) {
                try {
                    const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;
                    
                    // Clear existing data
                    await Database.clearAllData();
                    
                    // Import team members
                    for (const member of data.teamMembers || []) {
                        await Database.addTeamMember(member);
                    }
                    
                    // Import job assignments
                    for (const job of data.jobAssignments || []) {
                        await Database.addJobAssignment(job);
                    }
                    
                    // Import settings
                    if (data.settings) {
                        for (const [key, value] of Object.entries(data.settings)) {
                            if (value !== null && value !== undefined) {
                                await Database.setSetting(key, value);
                            }
                        }
                    }
                    
                    return { success: true, message: 'Data imported successfully' };
                } catch (error) {
                    return { success: false, message: 'Import failed: ' + error.message };
                }
            },
            
            async importFromCSV(csvText) {
                try {
                    const lines = csvText.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    // Get existing members
                    const members = await Database.getTeamMembers();
                    const memberLookup = {};
                    members.forEach(m => memberLookup[m.name] = m.id);
                    
                    const jobs = [];
                    for (let i = 1; i < lines.length; i++) {
                        if (!lines[i].trim()) continue;
                        
                        const values = lines[i].match(/(".*?"|[^,]+)/g).map(v => 
                            v.replace(/^"|"$/g, '').replace(/""/g, '"')
                        );
                        
                        const job = {
                            date: values[0],
                            memberId: memberLookup[values[1]] || 1,
                            title: values[2],
                            type: values[3],
                            duration: values[4],
                            priority: values[5],
                            client: values[6],
                            description: values[7],
                            notes: values[8],
                            status: values[9] || 'Scheduled',
                            month: values[0].substring(0, 7)
                        };
                        
                        jobs.push(job);
                    }
                    
                    // Import jobs
                    for (const job of jobs) {
                        await Database.addJobAssignment(job);
                    }
                    
                    return { success: true, message: `Imported ${jobs.length} jobs` };
                } catch (error) {
                    return { success: false, message: 'CSV import failed: ' + error.message };
                }
            },
            
            loadSampleData() {
                const sampleData = {
                    version: '1.0',
                    teamMembers: [
                        { id: 1, name: 'Sarah Martinez', role: 'UI/UX Designer', color: 'member-blue', avatar: 'SM' },
                        { id: 2, name: 'Alex Chen', role: 'Frontend Developer', color: 'member-green', avatar: 'AC' },
                        { id: 3, name: 'Maya Patel', role: 'Backend Developer', color: 'member-purple', avatar: 'MP' },
                        { id: 4, name: 'Jordan Kim', role: 'QA Engineer', color: 'member-yellow', avatar: 'JK' },
                        { id: 5, name: 'Lisa Wong', role: 'Project Manager', color: 'member-pink', avatar: 'LW' },
                        { id: 6, name: 'David Rodriguez', role: 'DevOps Engineer', color: 'member-orange', avatar: 'DR' }
                    ],
                    jobAssignments: [
                        { memberId: 1, date: '2025-09-03', month: '2025-09', day: 3, title: 'Website Mockups', type: 'design', duration: 'full', description: 'Creating wireframes and high-fidelity mockups', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Mobile-first approach' },
                        { memberId: 1, date: '2025-09-08', month: '2025-09', day: 8, title: 'Mobile App UI', type: 'design', duration: 'full', description: 'Designing mobile interface', client: 'StartupXYZ', priority: 'Medium', estimatedHours: 8, status: 'Not Started', notes: 'Research competitor apps' },
                        { memberId: 1, date: '2025-09-15', month: '2025-09', day: 15, title: 'Design Review', type: 'meeting', duration: 'half', description: 'Present mockups to stakeholders', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 4, status: 'Scheduled', notes: 'Prepare presentation' },
                        
                        { memberId: 2, date: '2025-09-01', month: '2025-09', day: 1, title: 'React Components', type: 'development', duration: 'full', description: 'Building dashboard components', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Data visualization' },
                        { memberId: 2, date: '2025-09-06', month: '2025-09', day: 6, title: 'API Integration', type: 'development', duration: 'full', description: 'Frontend API integration', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'Not Started', notes: 'Error handling' },
                        { memberId: 2, date: '2025-09-11', month: '2025-09', day: 11, title: 'Code Review', type: 'review', duration: 'half', description: 'Review team pull requests', client: 'Internal', priority: 'Medium', estimatedHours: 4, status: 'Scheduled', notes: 'Performance focus' },
                        
                        { memberId: 3, date: '2025-09-02', month: '2025-09', day: 2, title: 'Database Schema', type: 'development', duration: 'full', description: 'Database design updates', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'User permissions' },
                        { memberId: 3, date: '2025-09-09', month: '2025-09', day: 9, title: 'Performance Optimization', type: 'development', duration: 'full', description: 'Optimize queries and API', client: 'Internal', priority: 'Medium', estimatedHours: 8, status: 'Not Started', notes: '50% improvement target' },
                        { memberId: 3, date: '2025-09-11', month: '2025-09', day: 11, title: 'Security Review', type: 'review', duration: 'half', description: 'Security audit', client: 'Security Team', priority: 'High', estimatedHours: 4, status: 'Scheduled', notes: 'OWASP check' },
                        
                        { memberId: 4, date: '2025-09-06', month: '2025-09', day: 6, title: 'Automated Testing', type: 'testing', duration: 'full', description: 'Develop test automation', client: 'Multiple', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Integration tests' },
                        { memberId: 4, date: '2025-09-11', month: '2025-09', day: 11, title: 'Bug Verification', type: 'testing', duration: 'half', description: 'Verify bug fixes', client: 'Various', priority: 'High', estimatedHours: 4, status: 'Not Started', notes: 'Critical path check' },
                        { memberId: 4, date: '2025-09-13', month: '2025-09', day: 13, title: 'Release Testing', type: 'testing', duration: 'full', description: 'Final pre-release testing', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'Scheduled', notes: 'Smoke testing' },
                        
                        { memberId: 5, date: '2025-09-01', month: '2025-09', day: 1, title: 'Sprint Planning', type: 'meeting', duration: 'half', description: 'Plan sprint goals', client: 'Dev Team', priority: 'High', estimatedHours: 3, status: 'Scheduled', notes: 'Review velocity' },
                        { memberId: 5, date: '2025-09-07', month: '2025-09', day: 7, title: 'Stakeholder Meeting', type: 'meeting', duration: 'half', description: 'Weekly stakeholder update', client: 'Executives', priority: 'High', estimatedHours: 2, status: 'Scheduled', notes: 'Status presentation' },
                        { memberId: 5, date: '2025-09-11', month: '2025-09', day: 11, title: 'On-Call Support', type: 'on-call', duration: 'full', description: 'Emergency support coverage', client: 'Operations', priority: 'High', estimatedHours: 8, status: 'Active', notes: 'Monitor alerts' },
                        
                        { memberId: 6, date: '2025-09-03', month: '2025-09', day: 3, title: 'Infrastructure Setup', type: 'development', duration: 'full', description: 'CI/CD pipeline setup', client: 'Infrastructure', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Monitoring' },
                        { memberId: 6, date: '2025-09-10', month: '2025-09', day: 10, title: 'Performance Review', type: 'review', duration: 'half', description: 'System performance analysis', client: 'Operations', priority: 'Medium', estimatedHours: 4, status: 'Scheduled', notes: 'Resource usage' },
                        { memberId: 6, date: '2025-09-11', month: '2025-09', day: 11, title: 'Security Patches', type: 'development', duration: 'half', description: 'Apply security updates', client: 'Security', priority: 'High', estimatedHours: 4, status: 'Scheduled', notes: 'Maintenance window' }
                    ],
                    settings: {
                        syncMethod: 'local',
                        autoSync: true,
                        notifications: false,
                        offlineMode: true
                    }
                };
                
                return this.importFromJSON(sampleData);
            }
        };

        // App State
        const app = {
            currentMonth: new Date(2025, 8, 1), // September 2025
            currentDate: new Date(2025, 8, 11), // Today: September 11
            selectedMember: null,
            teamMembers: [],
            jobAssignments: [],
            settings: {
                syncMethod: 'local',
                autoSync: true,
                notifications: false,
                offlineMode: true,
                sheetId: '',
                apiUrl: '',
                apiKey: ''
            },
            syncInterval: null
        };

        // Utility Functions
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        
        function getDaysInMonth(date) {
            return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
        }

        function getFirstDayOfMonth(date) {
            return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
        }

        function isToday(day) {
            return day === app.currentDate.getDate() && 
                   app.currentMonth.getMonth() === app.currentDate.getMonth() &&
                   app.currentMonth.getFullYear() === app.currentDate.getFullYear();
        }

        function isWeekend(day) {
            const date = new Date(app.currentMonth.getFullYear(), app.currentMonth.getMonth(), day);
            const dayOfWeek = date.getDay();
            return dayOfWeek === 0 || dayOfWeek === 6;
        }

        function getJobTypeClass(type) {
            return `job-${type}`;
        }

        function showToast(message, type = 'info') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            // Show animation
            setTimeout(() => toast.classList.add('show'), 100);

            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getMonthString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        }

        // Data Functions
        async function loadDataFromDB() {
            try {
                app.teamMembers = await Database.getTeamMembers();
                const monthString = getMonthString(app.currentMonth);
                app.jobAssignments = await Database.getJobAssignments(monthString);
                
                // Update data status
                updateDataStatus();
                
                return true;
            } catch (error) {
                console.error('Failed to load data:', error);
                return false;
            }
        }

        function getTodaysJobs() {
            const today = app.currentDate.getDate();
            const monthString = getMonthString(app.currentDate);
            
            return app.jobAssignments
                .filter(job => job.day === today && job.month === monthString)
                .map(job => {
                    const member = app.teamMembers.find(m => m.id === job.memberId);
                    return {
                        ...job,
                        memberName: member?.name || 'Unknown',
                        memberAvatar: member?.avatar || '??',
                        memberColor: member?.color || 'member-gray'
                    };
                })
                .sort((a, b) => {
                    const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                    const typeOrder = { 'meeting': 4, 'on-call': 3, 'development': 2, 'design': 2, 'testing': 1 };
                    
                    const aPriority = priorityOrder[a.priority] || 0;
                    const bPriority = priorityOrder[b.priority] || 0;
                    const aType = typeOrder[a.type] || 0;
                    const bType = typeOrder[b.type] || 0;
                    
                    if (aType !== bType) return bType - aType;
                    return bPriority - aPriority;
                });
        }

        function getTodaysJobsForMember(memberId) {
            const today = app.currentDate.getDate();
            const monthString = getMonthString(app.currentDate);
            const member = app.teamMembers.find(m => m.id === memberId);
            
            if (!member) return [];

            return app.jobAssignments
                .filter(job => job.memberId === memberId && job.day === today && job.month === monthString)
                .map(job => ({
                    ...job,
                    memberName: member.name,
                    memberAvatar: member.avatar,
                    memberColor: member.color
                }));
        }

        function getJobsForMemberInMonth(memberId) {
            const monthString = getMonthString(app.currentMonth);
            return app.jobAssignments.filter(job => 
                job.memberId === memberId && job.month === monthString
            );
        }

        function getNonOnCallJobCount(memberId) {
            const jobs = getJobsForMemberInMonth(memberId);
            return jobs.filter(job => job.type !== 'on-call').length;
        }

        function hasNonOnCallJobs(memberId, day) {
            const monthString = getMonthString(app.currentMonth);
            const jobs = app.jobAssignments.filter(job => 
                job.memberId === memberId && job.day === day && job.month === monthString
            );
            return jobs.some(job => job.type !== 'on-call');
        }

        function getMemberColor(colorClass) {
            const colors = {
                'member-blue': '#3b82f6',
                'member-green': '#10b981',
                'member-purple': '#8b5cf6',
                'member-yellow': '#f59e0b',
                'member-pink': '#ec4899',
                'member-orange': '#f97316'
            };
            return colors[colorClass] || '#6b7280';
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Active': return 'var(--success-green)';
                case 'In Progress': return 'var(--primary-blue)';
                case 'Scheduled': return '#7c3aed';
                default: return 'var(--gray-600)';
            }
        }

        // Render Functions
        function updateMonthTitle() {
            document.getElementById('monthTitle').textContent = 
                `${monthNames[app.currentMonth.getMonth()]} ${app.currentMonth.getFullYear()}`;
        }

        function updateDataStatus() {
            document.getElementById('memberCount').textContent = app.teamMembers.length;
            document.getElementById('jobCount').textContent = app.jobAssignments.length;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
            document.getElementById('storageType').textContent = 
                app.settings.syncMethod === 'google' ? 'Google Sheets' :
                app.settings.syncMethod === 'api' ? 'Custom API' :
                'IndexedDB';
        }

        function updateSyncIndicator(status) {
            const indicator = document.getElementById('syncIndicator');
            const statusText = document.getElementById('syncStatus');
            
            indicator.className = 'sync-indicator';
            
            switch(status) {
                case 'syncing':
                    indicator.classList.add('syncing');
                    statusText.textContent = 'Syncing...';
                    break;
                case 'synced':
                    indicator.classList.add('synced');
                    statusText.textContent = 'Synced';
                    setTimeout(() => updateSyncIndicator('idle'), 3000);
                    break;
                case 'error':
                    indicator.classList.add('error');
                    statusText.textContent = 'Sync Error';
                    break;
                default:
                    statusText.textContent = app.settings.syncMethod === 'local' ? 'Local Storage' : 'Idle';
            }
        }

        function renderTodaysJobs(containerId, jobs, showMemberInfo = true) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (jobs.length === 0) {
                container.innerHTML = `
                    <div class="empty-jobs">
                        <div class="empty-jobs-icon">üìÖ</div>
                        <div>No jobs scheduled for today</div>
                    </div>
                `;
                return;
            }

            jobs.forEach(job => {
                const jobElement = document.createElement('div');
                jobElement.className = `job-item ${job.type === 'on-call' ? 'on-call' : ''}`;
                jobElement.onclick = () => showJobDetails(job);

                jobElement.innerHTML = `
                    <div class="job-content">
                        <div class="job-header">
                            <div class="job-type-badge ${getJobTypeClass(job.type)}">
                                ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                            </div>
                            <div class="priority-badge priority-${job.priority.toLowerCase()}">
                                ${job.priority}
                            </div>
                        </div>
                        
                        <div class="job-title">${job.title}</div>
                        ${showMemberInfo ? `<div class="job-member">${job.memberName}</div>` : ''}
                        <div class="job-client">${job.client}</div>
                        
                        <div class="job-duration">
                            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12,6 12,12 16,14"/>
                            </svg>
                            ${job.duration === 'full' ? 'Full Day' : 'Half Day'} (${job.estimatedHours || (job.duration === 'full' ? 8 : 4)}h)
                        </div>
                    </div>
                    ${showMemberInfo ? `<div class="avatar ${job.memberColor}">${job.memberAvatar}</div>` : ''}
                `;

                container.appendChild(jobElement);
            });
        }

        function renderTeamOverview() {
            const todaysJobs = getTodaysJobs();
            
            // Update today's jobs count
            document.getElementById('todayJobCount').textContent = todaysJobs.length;
            
            // Render today's jobs
            renderTodaysJobs('todayJobsList', todaysJobs, true);

            // Render team members
            const container = document.getElementById('teamMembersList');
            container.innerHTML = '';

            app.teamMembers.forEach(member => {
                const taskCount = getNonOnCallJobCount(member.id);
                const daysInMonth = getDaysInMonth(app.currentMonth);

                const card = document.createElement('div');
                card.className = 'team-card';
                card.onclick = () => selectMember(member);

                // Generate workload bar
                let workloadBar = '';
                for (let day = 1; day <= daysInMonth; day++) {
                    const hasJobs = hasNonOnCallJobs(member.id, day);
                    const weekend = isWeekend(day);
                    const today = isToday(day);
                    
                    let dayClass = 'workload-day ';
                    if (hasJobs) {
                        dayClass += member.color;
                    } else {
                        dayClass += weekend ? 'member-gray' : 'member-gray';
                    }
                    
                    workloadBar += `<div class="${dayClass}" style="background-color: ${hasJobs ? getMemberColor(member.color) : (weekend ? '#e5e7eb' : '#f3f4f6')}">${today ? '<div class="today-indicator"></div>' : ''}</div>`;
                }

                card.innerHTML = `
                    <div class="team-card-content">
                        <div class="team-info">
                            <div class="team-avatar ${member.color}">${member.avatar}</div>
                            <div class="team-details">
                                <h3>${member.name}</h3>
                                <p>${member.role}</p>
                            </div>
                        </div>
                        <div class="task-counter">
                            <div class="task-number">${taskCount}</div>
                            <div class="task-label">tasks</div>
                        </div>
                    </div>
                    <div class="workload-visualization">${workloadBar}</div>
                `;

                container.appendChild(card);
            });

            // Add button for adding new team member
            const addCard = document.createElement('div');
            addCard.className = 'team-card';
            addCard.style.border = '2px dashed var(--gray-300)';
            addCard.style.background = 'var(--gray-50)';
            addCard.onclick = () => showAddMemberDialog();
            addCard.innerHTML = `
                <div class="team-card-content" style="justify-content: center;">
                    <div class="team-info" style="justify-content: center; width: 100%;">
                        <div style="text-align: center;">
                            <div style="font-size: 32px; margin-bottom: 8px;">‚ûï</div>
                            <div style="color: var(--gray-600); font-size: 14px;">Add Team Member</div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(addCard);
        }

        function renderIndividualCalendar() {
            if (!app.selectedMember) return;

            // Update member's today jobs
            const memberTodaysJobs = getTodaysJobsForMember(app.selectedMember.id);
            document.getElementById('memberJobCount').textContent = memberTodaysJobs.length;
            document.getElementById('memberTodayTitle').textContent = `üìã ${app.selectedMember.name}'s Today`;
            renderTodaysJobs('memberTodayJobs', memberTodaysJobs, false);

            // Render calendar grid
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const daysInMonth = getDaysInMonth(app.currentMonth);
            const firstDay = getFirstDayOfMonth(app.currentMonth);
            const memberJobs = getJobsForMemberInMonth(app.selectedMember.id);

            // Empty cells before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day';
                grid.appendChild(emptyCell);
            }

            // Calendar days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                let classes = 'calendar-day';
                
                if (isWeekend(day)) classes += ' weekend';
                if (isToday(day)) classes += ' today';
                
                cell.className = classes;
                cell.onclick = () => showAddJobDialog(day);

                // Day number
                const dayNum = document.createElement('div');
                dayNum.className = 'day-number';
                dayNum.textContent = day;
                cell.appendChild(dayNum);

                // Jobs for this day
                const dayJobs = memberJobs.filter(job => job.day === day);
                const jobsContainer = document.createElement('div');
                jobsContainer.className = 'day-jobs';

                dayJobs.slice(0, 2).forEach(job => {
                    const jobEl = document.createElement('div');
                    jobEl.className = `mini-job ${getJobTypeClass(job.type)}`;
                    jobEl.textContent = job.title;
                    jobEl.onclick = (e) => {
                        e.stopPropagation();
                        const fullJob = { ...job, memberName: app.selectedMember.name };
                        showJobDetails(fullJob);
                    };
                    jobsContainer.appendChild(jobEl);
                });

                if (dayJobs.length > 2) {
                    const moreEl = document.createElement('div');
                    moreEl.className = 'more-jobs';
                    moreEl.textContent = `+${dayJobs.length - 2}`;
                    moreEl.onclick = (e) => {
                        e.stopPropagation();
                        showMultipleJobDetails(dayJobs, day, app.selectedMember.name);
                    };
                    jobsContainer.appendChild(moreEl);
                }

                cell.appendChild(jobsContainer);
                grid.appendChild(cell);
            }
        }

        function renderMemberSelection() {
            const container = document.getElementById('memberList');
            container.innerHTML = '';

            // All members option
            const allOption = document.createElement('div');
            allOption.className = `member-option ${!app.selectedMember ? 'selected' : ''}`;
            allOption.innerHTML = `
                <div class="avatar" style="background-color: var(--gray-500);">All</div>
                <div class="member-details">
                    <h3>All Team Members</h3>
                    <p>Overview Mode</p>
                </div>
            `;
            allOption.onclick = () => {
                selectMember(null);
                closeModal('memberModal');
            };
            container.appendChild(allOption);

            // Individual members
            app.teamMembers.forEach(member => {
                const option = document.createElement('div');
                option.className = `member-option ${app.selectedMember?.id === member.id ? 'selected' : ''}`;
                option.innerHTML = `
                    <div class="avatar ${member.color}">${member.avatar}</div>
                    <div class="member-details">
                        <h3>${member.name}</h3>
                        <p>${member.role}</p>
                    </div>
                `;
                option.onclick = () => {
                    selectMember(member);
                    closeModal('memberModal');
                };
                container.appendChild(option);
            });
        }

        function showJobDetails(job) {
            const container = document.getElementById('jobDetails');
            const priorityClass = `priority-${job.priority.toLowerCase()}`;
            const member = app.teamMembers.find(m => m.id === job.memberId);
            
            container.innerHTML = `
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">
                        <strong>${member?.name || job.memberName}</strong> - ${job.date}
                    </div>
                    
                    <div class="job-type-badge ${getJobTypeClass(job.type)}" style="margin-bottom: 12px;">
                        ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                    </div>
                    
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--gray-900);">
                        ${job.title}
                    </h3>
                    
                    <p style="color: var(--gray-700); margin-bottom: 20px; line-height: 1.5;">
                        ${job.description || 'No description provided'}
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Client:</div>
                            <div style="font-weight: 600; margin-top: 2px;">${job.client}</div>
                        </div>
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Duration:</div>
                            <div style="font-weight: 600; margin-top: 2px;">
                                ${job.duration === 'full' ? 'Full Day' : 'Half Day'} (${job.estimatedHours || (job.duration === 'full' ? 8 : 4)}h)
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Priority:</div>
                            <div class="${priorityClass}" style="font-weight: 600; margin-top: 2px;">${job.priority}</div>
                        </div>
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Status:</div>
                            <div style="font-weight: 600; margin-top: 2px; color: ${getStatusColor(job.status)};">
                                ${job.status}
                            </div>
                        </div>
                    </div>
                    
                    ${job.notes ? `
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600; margin-bottom: 8px;">Notes:</div>
                            <div style="background: var(--gray-50); padding: 12px; border-radius: 8px; border: 1px solid var(--gray-200); color: var(--gray-700);">
                                ${job.notes}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 20px; display: flex; gap: 8px;">
                        <button class="secondary-button" onclick="editJob(${job.id})" style="margin: 0; flex: 1;">Edit</button>
                        <button class="danger-button" onclick="deleteJob(${job.id})" style="margin: 0; flex: 1;">Delete</button>
                    </div>
                </div>
            `;
            
            showModal('jobModal');
        }

        function showMultipleJobDetails(jobs, day, memberName) {
            const container = document.getElementById('jobDetails');
            const jobsHtml = jobs.map(job => `
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 12px; margin-bottom: 12px; background: var(--white);">
                    <div class="job-type-badge ${getJobTypeClass(job.type)}" style="margin-bottom: 8px;">
                        ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                    </div>
                    <h4 style="font-weight: 600; margin-bottom: 4px;">${job.title}</h4>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 8px;">${job.description || 'No description'}</p>
                    <div style="font-size: 12px; color: var(--gray-500);">
                        <strong>Client:</strong> ${job.client} | 
                        <strong>Duration:</strong> ${job.duration === 'full' ? 'Full Day' : 'Half Day'} | 
                        <strong>Priority:</strong> ${job.priority}
                    </div>
                    ${job.notes ? `<div style="margin-top: 8px; padding: 8px; background: var(--gray-50); border-radius: 6px; font-size: 12px;"><strong>Notes:</strong> ${job.notes}</div>` : ''}
                </div>
            `).join('');

            container.innerHTML = `
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">
                        <strong>${memberName}</strong> - Day ${day}
                    </div>
                    ${jobsHtml}
                </div>
            `;
            
            showModal('jobModal');
        }

        function showAddJobDialog(day = null) {
            document.getElementById('editJobTitle').textContent = 'Add Job';
            document.getElementById('jobForm').reset();
            
            // Set default date if provided
            if (day) {
                const date = new Date(app.currentMonth.getFullYear(), app.currentMonth.getMonth(), day);
                document.getElementById('jobDate').value = formatDateForInput(date);
            } else {
                document.getElementById('jobDate').value = formatDateForInput(app.currentDate);
            }
            
            // Set default member if in individual view
            if (app.selectedMember) {
                document.getElementById('jobMember').value = app.selectedMember.id;
            }
            
            // Populate member dropdown
            const memberSelect = document.getElementById('jobMember');
            memberSelect.innerHTML = '';
            app.teamMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                memberSelect.appendChild(option);
            });
            
            showModal('editJobModal');
        }

        function showAddMemberDialog() {
            // This would show a form to add a new team member
            const name = prompt('Enter team member name:');
            if (!name) return;
            
            const role = prompt('Enter role:');
            if (!role) return;
            
            const colors = ['member-blue', 'member-green', 'member-purple', 'member-yellow', 'member-pink', 'member-orange'];
            const color = colors[app.teamMembers.length % colors.length];
            
            const avatar = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            
            const newMember = {
                name,
                role,
                color,
                avatar
            };
            
            Database.addTeamMember(newMember).then(() => {
                showToast('Team member added successfully', 'success');
                loadDataAndRefresh();
            }).catch(error => {
                showToast('Failed to add team member', 'error');
                console.error(error);
            });
        }

        async function editJob(jobId) {
            const job = app.jobAssignments.find(j => j.id === jobId);
            if (!job) return;
            
            document.getElementById('editJobTitle').textContent = 'Edit Job';
            document.getElementById('jobTitleInput').value = job.title;
            document.getElementById('jobType').value = job.type;
            document.getElementById('jobMember').value = job.memberId;
            document.getElementById('jobDate').value = job.date;
            document.getElementById('jobDuration').value = job.duration;
            document.getElementById('jobPriority').value = job.priority;
            document.getElementById('jobClient').value = job.client;
            document.getElementById('jobDescription').value = job.description || '';
            document.getElementById('jobNotes').value = job.notes || '';
            
            // Populate member dropdown
            const memberSelect = document.getElementById('jobMember');
            memberSelect.innerHTML = '';
            app.teamMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                memberSelect.appendChild(option);
            });
            
            // Store job ID for update
            document.getElementById('jobForm').dataset.jobId = jobId;
            
            closeModal('jobModal');
            showModal('editJobModal');
        }

        async function deleteJob(jobId) {
            if (!confirm('Are you sure you want to delete this job?')) return;
            
            try {
                await Database.deleteJobAssignment(jobId);
                showToast('Job deleted successfully', 'success');
                closeModal('jobModal');
                await loadDataAndRefresh();
            } catch (error) {
                showToast('Failed to delete job', 'error');
                console.error(error);
            }
        }

        // Event Handlers
        function selectMember(member) {
            app.selectedMember = member;
            
            if (member) {
                // Show member info in header
                document.getElementById('memberInfoBar').classList.remove('hidden');
                document.getElementById('selectedAvatar').className = `avatar ${member.color}`;
                document.getElementById('selectedAvatar').textContent = member.avatar;
                document.getElementById('selectedName').textContent = member.name;
                document.getElementById('selectedRole').textContent = member.role;
                
                // Switch to individual view
                document.getElementById('teamOverview').classList.add('hidden');
                document.getElementById('individualCalendar').classList.remove('hidden');
                renderIndividualCalendar();
            } else {
                // Hide member info
                document.getElementById('memberInfoBar').classList.add('hidden');
                
                // Switch to team view
                document.getElementById('teamOverview').classList.remove('hidden');
                document.getElementById('individualCalendar').classList.add('hidden');
                renderTeamOverview();
            }
        }

        async function navigateMonth(direction) {
            app.currentMonth = new Date(app.currentMonth.getFullYear(), app.currentMonth.getMonth() + direction, 1);
            updateMonthTitle();
            
            await loadDataFromDB();
            
            if (app.selectedMember) {
                renderIndividualCalendar();
            } else {
                renderTeamOverview();
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('.modal').classList.add('show');
            }, 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('.modal').classList.remove('show');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        async function saveSettings() {
            app.settings.syncMethod = document.getElementById('syncMethod').value;
            app.settings.autoSync = document.getElementById('autoSync').checked;
            app.settings.notifications = document.getElementById('notifications').checked;
            app.settings.offlineMode = document.getElementById('offlineMode').checked;
            app.settings.sheetId = document.getElementById('sheetId').value.trim();
            app.settings.apiUrl = document.getElementById('apiUrl').value.trim();
            app.settings.apiKey = document.getElementById('apiKey').value.trim();

            // Save to database
            for (const [key, value] of Object.entries(app.settings)) {
                await Database.setSetting(key, value);
            }

            // Setup auto-sync if enabled
            if (app.settings.autoSync) {
                startAutoSync();
            } else {
                stopAutoSync();
            }

            showToast('Settings saved successfully!', 'success');
            closeModal('settingsModal');
        }

        async function loadSettings() {
            for (const key of Object.keys(app.settings)) {
                const value = await Database.getSetting(key);
                if (value !== undefined) {
                    app.settings[key] = value;
                }
            }

            // Update form
            document.getElementById('syncMethod').value = app.settings.syncMethod;
            document.getElementById('autoSync').checked = app.settings.autoSync;
            document.getElementById('notifications').checked = app.settings.notifications;
            document.getElementById('offlineMode').checked = app.settings.offlineMode;
            document.getElementById('sheetId').value = app.settings.sheetId;
            document.getElementById('apiUrl').value = app.settings.apiUrl;
            document.getElementById('apiKey').value = app.settings.apiKey;

            // Show/hide sync config based on method
            updateSyncMethodUI();
        }

        function updateSyncMethodUI() {
            const method = document.getElementById('syncMethod').value;
            document.getElementById('googleSheetsConfig').classList.toggle('hidden', method !== 'google');
            document.getElementById('apiConfig').classList.toggle('hidden', method !== 'api');
        }

        function startAutoSync() {
            stopAutoSync(); // Clear any existing interval
            
            if (app.settings.syncMethod !== 'local') {
                app.syncInterval = setInterval(() => {
                    syncData();
                }, 5 * 60 * 1000); // 5 minutes
            }
        }

        function stopAutoSync() {
            if (app.syncInterval) {
                clearInterval(app.syncInterval);
                app.syncInterval = null;
            }
        }

        async function syncData() {
            if (app.settings.syncMethod === 'local') return;
            
            updateSyncIndicator('syncing');
            
            try {
                // Implement actual sync based on method
                if (app.settings.syncMethod === 'google') {
                    // Google Sheets sync would go here
                    // For now, just simulate
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } else if (app.settings.syncMethod === 'api') {
                    // Custom API sync would go here
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                updateSyncIndicator('synced');
            } catch (error) {
                console.error('Sync failed:', error);
                updateSyncIndicator('error');
            }
        }

        async function loadDataAndRefresh() {
            await loadDataFromDB();
            
            if (app.selectedMember) {
                renderIndividualCalendar();
            } else {
                renderTeamOverview();
            }
            
            renderMemberSelection();
            updateDataStatus();
        }

        // Event Listeners
        document.getElementById('menuButton').onclick = () => showModal('memberModal');
        document.getElementById('prevButton').onclick = () => navigateMonth(-1);
        document.getElementById('nextButton').onclick = () => navigateMonth(1);
        document.getElementById('settingsButton').onclick = () => showModal('settingsModal');
        
        document.getElementById('closeMemberModal').onclick = () => closeModal('memberModal');
        document.getElementById('closeSettingsModal').onclick = () => closeModal('settingsModal');
        document.getElementById('closeJobModal').onclick = () => closeModal('jobModal');
        document.getElementById('closeEditJobModal').onclick = () => closeModal('editJobModal');
        
        document.getElementById('saveSettings').onclick = saveSettings;
        document.getElementById('syncMethod').onchange = updateSyncMethodUI;
        
        // File upload handlers
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');
        
        fileUploadArea.onclick = () => fileInput.click();
        
        fileUploadArea.ondragover = (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        };
        
        fileUploadArea.ondragleave = () => {
            fileUploadArea.classList.remove('dragover');
        };
        
        fileUploadArea.ondrop = async (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file) {
                await handleFileUpload(file);
            }
        };
        
        fileInput.onchange = async (e) => {
            const file = e.target.files[0];
            if (file) {
                await handleFileUpload(file);
            }
        };
        
        async function handleFileUpload(file) {
            const reader = new FileReader();
            
            reader.onload = async (e) => {
                const content = e.target.result;
                let result;
                
                if (file.name.endsWith('.json')) {
                    result = await DataManager.importFromJSON(content);
                } else if (file.name.endsWith('.csv')) {
                    result = await DataManager.importFromCSV(content);
                } else {
                    showToast('Unsupported file format', 'error');
                    return;
                }
                
                if (result.success) {
                    showToast(result.message, 'success');
                    await loadDataAndRefresh();
                } else {
                    showToast(result.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Export handlers
        document.getElementById('exportJSON').onclick = () => DataManager.exportToJSON();
        document.getElementById('exportCSV').onclick = () => DataManager.exportToCSV();
        
        // Load sample data handler
        document.getElementById('loadSampleData').onclick = async () => {
            const result = await DataManager.loadSampleData();
            if (result.success) {
                showToast('Sample data loaded successfully', 'success');
                await loadDataAndRefresh();
            } else {
                showToast('Failed to load sample data', 'error');
            }
        };
        
        // Clear data handler
        document.getElementById('clearData').onclick = async () => {
            if (!confirm('Are you sure you want to clear all data? This cannot be undone.')) return;
            
            try {
                await Database.clearAllData();
                showToast('All data cleared', 'success');
                await loadDataAndRefresh();
            } catch (error) {
                showToast('Failed to clear data', 'error');
                console.error(error);
            }
        };
        
        // Job form submission
        document.getElementById('jobForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const form = e.target;
            const jobId = form.dataset.jobId;
            
            const dateValue = document.getElementById('jobDate').value;
            const date = new Date(dateValue);
            
            const job = {
                title: document.getElementById('jobTitleInput').value,
                type: document.getElementById('jobType').value,
                memberId: parseInt(document.getElementById('jobMember').value),
                date: dateValue,
                month: getMonthString(date),
                day: date.getDate(),
                duration: document.getElementById('jobDuration').value,
                priority: document.getElementById('jobPriority').value,
                client: document.getElementById('jobClient').value,
                description: document.getElementById('jobDescription').value,
                notes: document.getElementById('jobNotes').value,
                status: 'Scheduled',
                estimatedHours: document.getElementById('jobDuration').value === 'full' ? 8 : 4
            };
            
            try {
                if (jobId) {
                    // Update existing job
                    job.id = parseInt(jobId);
                    await Database.updateJobAssignment(job);
                    showToast('Job updated successfully', 'success');
                } else {
                    // Add new job
                    await Database.addJobAssignment(job);
                    showToast('Job added successfully', 'success');
                }
                
                delete form.dataset.jobId;
                closeModal('editJobModal');
                await loadDataAndRefresh();
            } catch (error) {
                showToast('Failed to save job', 'error');
                console.error(error);
            }
        };

        // Close modals on overlay click
        ['memberModal', 'settingsModal', 'jobModal', 'editJobModal'].forEach(modalId => {
            document.getElementById(modalId).onclick = (e) => {
                if (e.target.id === modalId) {
                    closeModal(modalId);
                }
            };
        });

        // Initialize App
        async function initializeApp() {
            try {
                // Initialize database
                await Database.init();
                
                // Load settings
                await loadSettings();
                
                // Load data
                const hasData = await loadDataFromDB();
                
                // If no data, offer to load sample data
                if (!hasData || app.teamMembers.length === 0) {
                    setTimeout(() => {
                        if (confirm('No data found. Would you like to load sample data to get started?')) {
                            document.getElementById('loadSampleData').click();
                        }
                    }, 1000);
                }
                
                // Update UI
                updateMonthTitle();
                renderTeamOverview();
                renderMemberSelection();
                
                // Start auto-sync if enabled
                if (app.settings.autoSync) {
                    startAutoSync();
                }
                
                // Register service worker for PWA
                if ('serviceWorker' in navigator) {
                    const swCode = `
                        const CACHE_NAME = 'team-calendar-v3';
                        const urlsToCache = ['/'];
                        
                        self.addEventListener('install', event => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then(cache => cache.addAll(urlsToCache))
                            );
                            self.skipWaiting();
                        });
                        
                        self.addEventListener('fetch', event => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => response || fetch(event.request))
                            );
                        });
                        
                        self.addEventListener('activate', event => {
                            event.waitUntil(self.clients.claim());
                        });
                    `;
                    
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    navigator.serviceWorker.register(swUrl)
                        .then(() => {
                            console.log('PWA Service Worker registered');
                        })
                        .catch(err => console.log('Service Worker registration failed:', err));
                }
                
                // Show welcome message
                setTimeout(() => {
                    showToast('Team Calendar ready! Click settings to manage data.', 'info');
                }, 1500);
                
            } catch (error) {
                console.error('Failed to initialize app:', error);
                showToast('Failed to initialize app', 'error');
            }
        }

        // Start app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // PWA Installation Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA install available');
        });

        window.addEventListener('appinstalled', () => {
            showToast('Team Calendar installed successfully!', 'success');
            deferredPrompt = null;
        });
    </script>
</body>
</html>
