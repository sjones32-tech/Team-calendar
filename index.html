<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BAI Team Calendar</title>
    <meta name="description" content="BAI Communications team resource calendar">
    <meta name="theme-color" content="#3b82f6">

```
<!-- PWA Configuration -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="BAI Calendar">

<!-- SheetJS for Excel Parsing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        background: #f9fafb;
        color: #1f2937;
        -webkit-font-smoothing: antialiased;
    }
    
    .container {
        max-width: 428px;
        margin: 0 auto;
        min-height: 100vh;
        background: white;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    
    /* Header */
    .header {
        background: white;
        padding: 16px;
        border-bottom: 1px solid #e5e7eb;
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .btn {
        background: none;
        border: none;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .btn:hover { background: #f3f4f6; }
    .btn:active { transform: scale(0.95); }
    
    .month-nav {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    
    .month-title {
        font-size: 18px;
        font-weight: 600;
        min-width: 150px;
        text-align: center;
    }
    
    .status-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 8px;
        font-size: 12px;
        border-top: 1px solid #e5e7eb;
    }
    
    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .status-excel { background: #10b981; }
    .status-sample { background: #f59e0b; }
    
    /* Content */
    .content {
        padding: 16px;
    }
    
    /* Today's Jobs Card */
    .jobs-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        margin-bottom: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px 12px 0 0;
    }
    
    .card-title {
        font-size: 16px;
        font-weight: 600;
    }
    
    .badge {
        background: rgba(255,255,255,0.2);
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .jobs-list {
        padding: 12px 16px 16px;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .job {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 8px;
        transition: all 0.2s;
    }
    
    .job:hover {
        background: #f9fafb;
        transform: translateY(-1px);
    }
    
    .job.on-call {
        border-color: #fca5a5;
        background: #fef2f2;
    }
    
    .avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
        font-weight: 700;
        flex-shrink: 0;
    }
    
    .job-info {
        flex: 1;
        min-width: 0;
    }
    
    .job-badges {
        display: flex;
        gap: 4px;
        margin-bottom: 4px;
        flex-wrap: wrap;
    }
    
    .type-badge {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
    }
    
    .priority-badge {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
    }
    
    .job-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 2px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .job-meta {
        font-size: 12px;
        color: #6b7280;
    }
    
    /* Job Type Colors */
    .job-design { background: #dbeafe; color: #1e40af; }
    .job-development { background: #dcfce7; color: #166534; }
    .job-testing { background: #fef3c7; color: #92400e; }
    .job-meeting { background: #e9d5ff; color: #7c3aed; }
    .job-review { background: #fed7aa; color: #c2410c; }
    .job-planning { background: #fce7f3; color: #be185d; }
    .job-on-call { background: #fee2e2; color: #dc2626; }
    
    /* Priority Colors */
    .priority-high { background: #fef2f2; color: #dc2626; }
    .priority-medium { background: #fef3c7; color: #d97706; }
    .priority-low { background: #ecfdf5; color: #059669; }
    
    /* Member Colors */
    .member-blue { background: #3b82f6; }
    .member-green { background: #10b981; }
    .member-purple { background: #8b5cf6; }
    .member-yellow { background: #f59e0b; }
    .member-pink { background: #ec4899; }
    .member-orange { background: #f97316; }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 32px 16px;
        color: #6b7280;
    }
    
    /* Upload Area */
    .upload-area {
        background: #f0f9ff;
        border: 2px dashed #3b82f6;
        border-radius: 12px;
        padding: 32px 16px;
        text-align: center;
        margin-bottom: 16px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .upload-area:hover {
        background: #e0f2fe;
        border-color: #2563eb;
    }
    
    .upload-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }
    
    .upload-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .upload-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 12px;
    }
    
    .file-input {
        display: none;
    }
    
    .hidden {
        display: none !important;
    }
    
    .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #e5e7eb;
        border-top: 2px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .toast {
        position: fixed;
        top: 20px;
        left: 16px;
        right: 16px;
        max-width: 400px;
        margin: 0 auto;
        padding: 12px 16px;
        border-radius: 8px;
        font-weight: 600;
        z-index: 2000;
        transform: translateY(-100px);
        transition: transform 0.3s;
    }
    
    .toast.show { transform: translateY(0); }
    .toast-success { background: #10b981; color: white; }
    .toast-error { background: #ef4444; color: white; }
    .toast-info { background: #3b82f6; color: white; }
</style>
```

</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-row">
                <button class="btn" onclick="location.reload()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 4v6h6M23 20v-6h-6"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                </button>

```
            <h1 class="month-title">BAI Team Calendar</h1>
            
            <button class="btn" onclick="showUpload()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            </button>
        </div>
        
        <div class="status-bar">
            <div class="status-dot status-sample" id="statusDot"></div>
            <span id="statusText">Using sample data - Upload Excel file</span>
        </div>
    </div>

    <!-- Content -->
    <div class="content">
        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ðŸ“‚</div>
            <h3 class="upload-title">Upload Your Excel File</h3>
            <p style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">
                TeamCalendar_202404.xlsx
            </p>
            <input type="file" class="file-input" id="fileInput" accept=".xlsx,.xls" />
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                Choose File
            </button>
        </div>

        <!-- Today's Jobs -->
        <div class="jobs-card">
            <div class="card-header">
                <h2 class="card-title">ðŸ“… Today's Scheduled Jobs</h2>
                <div class="badge" id="todayCount">0</div>
            </div>
            <div class="jobs-list" id="todayJobs">
                <div class="empty-state">Upload Excel file to load real data</div>
            </div>
        </div>

        <!-- On-Call -->
        <div class="jobs-card">
            <div class="card-header">
                <h2 class="card-title">ðŸš¨ Today's On-Call</h2>
            </div>
            <div class="jobs-list" id="onCallInfo">
                <div class="empty-state">Upload Excel file to see on-call person</div>
            </div>
        </div>

        <!-- Team Members -->
        <div class="jobs-card">
            <div class="card-header">
                <h2 class="card-title">ðŸ‘¥ Team Members</h2>
            </div>
            <div class="jobs-list" id="teamList">
                <div class="empty-state">Upload Excel file to see team</div>
            </div>
        </div>
    </div>
</div>

<script>
    let appData = {
        teamMembers: [],
        jobAssignments: {},
        currentDate: new Date(2024, 3, 12) // April 12, 2024
    };

    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    function showUpload() {
        document.getElementById('fileInput').click();
    }

    // Excel File Processing
    document.getElementById('fileInput').onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        try {
            showToast('Processing Excel file...', 'info');
            
            const arrayBuffer = await file.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array', cellDates: true });

            console.log('Workbook sheets:', workbook.SheetNames);

            // Parse Team Members
            const teamSheet = workbook.Sheets['Team Members'];
            if (teamSheet) {
                const teamData = XLSX.utils.sheet_to_json(teamSheet, { header: 1 });
                console.log('Team Members data:', teamData);
                
                appData.teamMembers = teamData.slice(1).map(row => ({
                    id: parseInt(row[0]),
                    name: row[1],
                    role: row[2],
                    color: row[3],
                    avatar: row[4]
                })).filter(m => m.id && m.name);
            }

            // Parse Job Assignments
            const jobSheet = workbook.Sheets['Job Assignments'];
            if (jobSheet) {
                const jobData = XLSX.utils.sheet_to_json(jobSheet, { header: 1 });
                console.log('Job Assignments data:', jobData);
                
                appData.jobAssignments = {};
                jobData.slice(1).forEach(row => {
                    if (row[0] && row[1] && row[2]) {
                        const memberId = parseInt(row[0]);
                        const date = new Date(row[1]);
                        const day = date.getDate();

                        const job = {
                            title: row[2],
                            type: row[3],
                            duration: row[4],
                            description: row[5],
                            client: row[6],
                            priority: row[7],
                            estimatedHours: parseFloat(row[8]),
                            status: row[9],
                            notes: row[10]
                        };

                        if (!appData.jobAssignments[memberId]) {
                            appData.jobAssignments[memberId] = {};
                        }
                        if (!appData.jobAssignments[memberId][day]) {
                            appData.jobAssignments[memberId][day] = [];
                        }
                        appData.jobAssignments[memberId][day].push(job);
                    }
                });
            }

            console.log('Parsed data:', appData);

            document.getElementById('statusDot').className = 'status-dot status-excel';
            document.getElementById('statusText').textContent = `Loaded from ${file.name}`;
            document.getElementById('uploadArea').classList.add('hidden');
            
            renderApp();
            showToast('Excel file loaded successfully!', 'success');

        } catch (error) {
            console.error('Error processing Excel:', error);
            showToast('Error: ' + error.message, 'error');
        }
    };

    function renderApp() {
        renderTodaysJobs();
        renderOnCall();
        renderTeamList();
    }

    function renderTodaysJobs() {
        const today = appData.currentDate.getDate();
        const allJobs = [];

        for (const memberId in appData.jobAssignments) {
            const memberJobs = appData.jobAssignments[memberId]?.[today] || [];
            const member = appData.teamMembers.find(m => m.id === parseInt(memberId));
            
            if (member) {
                memberJobs.forEach(job => {
                    allJobs.push({ ...job, member });
                });
            }
        }

        document.getElementById('todayCount').textContent = allJobs.length;

        const container = document.getElementById('todayJobs');
        if (allJobs.length === 0) {
            container.innerHTML = '<div class="empty-state">No jobs scheduled for today</div>';
            return;
        }

        container.innerHTML = '';
        allJobs.forEach(job => {
            const jobEl = document.createElement('div');
            jobEl.className = `job ${job.type === 'on-call' ? 'on-call' : ''}`;
            
            jobEl.innerHTML = `
                <div class="avatar ${job.member.color}">${job.member.avatar}</div>
                <div class="job-info">
                    <div class="job-badges">
                        <div class="type-badge job-${job.type}">
                            ${(job.type || 'task').charAt(0).toUpperCase() + (job.type || 'task').slice(1)}
                        </div>
                        <div class="priority-badge priority-${(job.priority || 'medium').toLowerCase()}">
                            ${job.priority || 'Medium'}
                        </div>
                    </div>
                    <div class="job-title">${job.title}</div>
                    <div class="job-meta">${job.member.name} â€¢ ${job.client || 'No client'}</div>
                    <div class="job-meta">
                        ${job.duration === 'full' ? 'Full Day' : 'Half Day'} (${job.estimatedHours || 8}h)
                    </div>
                </div>
            `;
            container.appendChild(jobEl);
        });
    }

    function renderOnCall() {
        const today = appData.currentDate.getDate();
        let onCallPerson = null;

        for (const memberId in appData.jobAssignments) {
            const memberJobs = appData.jobAssignments[memberId]?.[today] || [];
            if (memberJobs.some(job => job.type === 'on-call')) {
                onCallPerson = appData.teamMembers.find(m => m.id === parseInt(memberId));
                break;
            }
        }

        const container = document.getElementById('onCallInfo');
        if (onCallPerson) {
            container.innerHTML = `
                <div class="job on-call">
                    <div class="avatar ${onCallPerson.color}">${onCallPerson.avatar}</div>
                    <div class="job-info">
                        <div class="job-title">${onCallPerson.name}</div>
                        <div class="job-meta">${onCallPerson.role}</div>
                        <div class="job-meta" style="color: #dc2626; font-weight: 600;">
                            ðŸš¨ Available for emergency support
                        </div>
                    </div>
                </div>
            `;
        } else {
            container.innerHTML = '<div class="empty-state">No one on-call today</div>';
        }
    }

    function renderTeamList() {
        const container = document.getElementById('teamList');
        
        if (appData.teamMembers.length === 0) {
            container.innerHTML = '<div class="empty-state">No team members loaded</div>';
            return;
        }

        container.innerHTML = '';
        appData.teamMembers.forEach(member => {
            const jobCount = Object.values(appData.jobAssignments[member.id] || {})
                .flat()
                .filter(j => j.type !== 'on-call')
                .length;

            const memberEl = document.createElement('div');
            memberEl.className = 'job';
            memberEl.innerHTML = `
                <div class="avatar ${member.color}">${member.avatar}</div>
                <div class="job-info">
                    <div class="job-title">${member.name}</div>
                    <div class="job-meta">${member.role} â€¢ ${jobCount} tasks this month</div>
                </div>
            `;
            container.appendChild(memberEl);
        });
    }

    console.log('BAI Team Calendar ready. Upload your Excel file to begin.');
</script>
```

</body>
</html>