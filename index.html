<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Team Calendar</title>
    <meta name="description" content="Professional team resource calendar with today's jobs and OneDrive integration">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- PWA Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Team Calendar">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGVhbSBDYWxlbmRhciIsInNob3J0X25hbWUiOiJUZWFtQ2FsIiwiZGVzY3JpcHRpb24iOiJQcm9mZXNzaW9uYWwgdGVhbSByZXNvdXJjZSBjYWxlbmRhciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjM2I4MmY2Iiwib3JpZW50YXRpb24iOiJwb3J0cmFpdCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlTU0l3SURBZ01qVTJJREkxTmlKZ1ptbHNiRDBpSXpNeU9EZG1OaUkrUEhKbFkzUWdlRDBpTkRnaUlIazlJalE0SWlCM2FXUjBhRDBpTVRZd0lpQm9aV2xuYUhROUlqRTJNQ0lnWm1sc2JEMGlJelEzT0RBME1DSXZQand2YzNabmZqND0iLCJzaXplcyI6IjI1NngyNTYiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCIsInB1cnBvc2UiOiJtYXNrYWJsZSJ9LHsic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5U1NJd0lEQWdOVEV5SURRNE1pSWdabWxzYkQwaVdURXhZemhpT0NJK1BISmxZM1FnZUQwaU1USWlJSGs5SWpFeUlpQjNhV1IwYUQwaVF6QTRJaUJvWldsbmFIUTlTU0pETURnaUlHWnBiR3c5U1NKUFJtWm1abVlpTHo0OEwzTjJaejQ9Iiwic2l6ZXMiOiI1MTJ4NDgyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJwdXJwb3NlIjoiYW55In1dfQ==">
    
    <!-- App Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTYgMjU2IiBmaWxsPSIjMzI4N2Y2Ij48cmVjdCB4PSI0OCIgeT0iNDgiIHdpZHRoPSIxNjAiIGhlaWdodD0iMTYwIiBmaWxsPSIjNDcwNDAiLz48L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNDgyIiBmaWxsPSJZMjhiOCIrPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iQzA4IiBoZWlnaHQ9IkMwOCIgZmlsbD0iT0ZmZmZmIi8+PC9zdmc+">
    
    <style>
        /* CSS Variables for Easy Customization */
        :root {
            --primary-blue: #3b82f6;
            --primary-hover: #2563eb;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --border-radius: 8px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--white);
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        /* Header Styles */
        .app-header {
            background: var(--white);
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .icon-button {
            background: none;
            border: none;
            padding: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            min-height: 40px;
        }

        .icon-button:hover {
            background-color: var(--gray-100);
        }

        .icon-button:active {
            background-color: var(--gray-200);
            transform: scale(0.95);
        }

        .month-navigation {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .month-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            min-width: 160px;
            text-align: center;
        }

        .member-info-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-top: 1px solid var(--gray-200);
        }

        .avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .member-details h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .member-details p {
            font-size: 12px;
            color: var(--gray-500);
            margin: 0;
        }

        /* Main Content */
        .main-content {
            padding: 16px;
            min-height: calc(100vh - 200px);
        }

        .page-title {
            text-align: center;
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 16px;
        }

        /* Today's Jobs Card */
        .todays-jobs-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 16px 12px;
            border-bottom: 1px solid var(--gray-100);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .job-count-badge {
            background: var(--primary-blue);
            color: var(--white);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .jobs-list {
            max-height: 240px;
            overflow-y: auto;
            padding: 8px 16px 16px;
        }

        .job-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .job-item:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .job-item:active {
            transform: scale(0.98);
        }

        .job-item.on-call {
            border-color: #fca5a5;
            background: #fef2f2;
        }

        .job-content {
            flex: 1;
            min-width: 0;
        }

        .job-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
            flex-wrap: wrap;
        }

        .job-type-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid;
        }

        .priority-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .priority-high { background: #fef2f2; color: #dc2626; }
        .priority-medium { background: #fef3c7; color: #d97706; }
        .priority-low { background: #ecfdf5; color: #059669; }

        .job-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .job-member {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 2px;
        }

        .job-client {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .job-duration {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--gray-500);
        }

        .empty-jobs {
            text-align: center;
            padding: 32px 16px;
            color: var(--gray-500);
        }

        .empty-jobs-icon {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        /* On-Call Card */
        .oncall-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .oncall-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .oncall-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .oncall-person {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .oncall-badge {
            background: #fef2f2;
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid #fca5a5;
        }

        /* Team Cards */
        .team-members {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .team-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .team-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .team-card:active {
            transform: scale(0.98);
        }

        .team-card-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 14px;
            font-weight: 700;
        }

        .team-details h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0 0 2px 0;
        }

        .team-details p {
            font-size: 12px;
            color: var(--gray-500);
            margin: 0;
        }

        .task-counter {
            text-align: right;
        }

        .task-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-700);
            line-height: 1;
        }

        .task-label {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Workload Bar */
        .workload-visualization {
            display: flex;
            gap: 1px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .workload-day {
            flex: 1;
            min-width: 2px;
            position: relative;
        }

        .today-indicator {
            position: absolute;
            inset: -2px;
            border: 2px solid var(--primary-blue);
            border-radius: 4px;
        }

        /* Individual Calendar */
        .calendar-section {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow);
            margin-top: 16px;
        }

        .week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .week-day {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            padding: 8px 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            height: 52px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            padding: 2px;
            position: relative;
            background: var(--white);
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .calendar-day:hover {
            background: var(--gray-50);
            box-shadow: var(--shadow);
        }

        .calendar-day.weekend {
            background: var(--gray-50);
        }

        .calendar-day.today {
            border: 2px solid var(--primary-blue);
            background: #eff6ff;
        }

        .day-number {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
            color: var(--gray-600);
            font-weight: 600;
        }

        .today .day-number {
            background: var(--primary-blue);
            color: var(--white);
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 9px;
        }

        .day-jobs {
            margin-top: 14px;
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .mini-job {
            padding: 1px 3px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: 600;
            border: 1px solid;
            cursor: pointer;
            transition: opacity 0.2s;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .mini-job:hover {
            opacity: 0.8;
        }

        .more-jobs {
            font-size: 7px;
            color: var(--gray-500);
            text-align: center;
            cursor: pointer;
        }

        /* Job Type Colors */
        .job-design { 
            background: #dbeafe; 
            color: #1e40af; 
            border-color: #93c5fd; 
        }
        .job-development { 
            background: #dcfce7; 
            color: #166534; 
            border-color: #86efac; 
        }
        .job-testing { 
            background: #fef3c7; 
            color: #92400e; 
            border-color: #fde047; 
        }
        .job-meeting { 
            background: #e9d5ff; 
            color: #7c3aed; 
            border-color: #c4b5fd; 
        }
        .job-review { 
            background: #fed7aa; 
            color: #c2410c; 
            border-color: #fdba74; 
        }
        .job-planning { 
            background: #fce7f3; 
            color: #be185d; 
            border-color: #f9a8d4; 
        }
        .job-on-call { 
            background: #fee2e2; 
            color: #dc2626; 
            border-color: #fca5a5; 
        }

        /* Member Colors */
        .member-blue { background-color: var(--primary-blue); }
        .member-green { background-color: var(--success-green); }
        .member-purple { background-color: #8b5cf6; }
        .member-yellow { background-color: var(--warning-orange); }
        .member-pink { background-color: #ec4899; }
        .member-orange { background-color: #f97316; }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 0;
        }

        .modal {
            background: var(--white);
            border-radius: 16px 16px 0 0;
            width: 100%;
            max-width: 428px;
            max-height: 85vh;
            overflow: hidden;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .modal.show {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .modal-body {
            padding: 16px;
            overflow-y: auto;
            max-height: calc(85vh - 80px);
        }

        /* Member Selection */
        .member-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .member-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .member-option:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .member-option:active {
            transform: scale(0.98);
        }

        .member-option.selected {
            background: #eff6ff;
            border-color: var(--primary-blue);
        }

        /* Settings */
        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 12px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: border-color 0.2s ease;
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-help {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 0;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-blue);
        }

        .primary-button {
            width: 100%;
            padding: 12px;
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .primary-button:hover {
            background: var(--primary-hover);
        }

        .primary-button:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
        }

        .secondary-button {
            width: 100%;
            padding: 12px;
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }

        .secondary-button:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        /* Legend */
        .legend {
            background: var(--white);
            padding: 16px;
            border-top: 1px solid var(--gray-200);
        }

        .legend-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .legend-item {
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            border: 1px solid;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            left: 16px;
            right: 16px;
            max-width: 400px;
            margin: 0 auto;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 600;
            z-index: 2000;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
        }

        .toast-success { background: var(--success-green); color: var(--white); }
        .toast-error { background: var(--error-red); color: var(--white); }
        .toast-info { background: var(--primary-blue); color: var(--white); }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 375px) {
            .app-container {
                max-width: 100%;
            }
            .main-content {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-row">
                <button class="icon-button" id="menuButton" aria-label="Open menu">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>
                
                <nav class="month-navigation">
                    <button class="icon-button" id="prevButton" aria-label="Previous month">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <h1 class="month-title" id="monthTitle">March 2024</h1>
                    <button class="icon-button" id="nextButton" aria-label="Next month">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                </nav>
                
                <button class="icon-button" id="settingsButton" aria-label="Open settings">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>
            
            <div class="member-info-bar hidden" id="memberInfoBar">
                <div class="avatar member-blue" id="selectedAvatar">SM</div>
                <div class="member-details">
                    <h3 id="selectedName">Sarah Martinez</h3>
                    <p id="selectedRole">UI/UX Designer</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Team Overview -->
            <div id="teamOverview">
                <div class="page-title">
                    Team Overview - Select a member for detailed view
                </div>
                
                <!-- Today's Jobs Card -->
                <div class="todays-jobs-card">
                    <div class="card-header">
                        <h2 class="card-title">ðŸ“… Today's Scheduled Jobs</h2>
                        <div class="job-count-badge" id="todayJobCount">0</div>
                    </div>
                    <div class="jobs-list" id="todayJobsList">
                        <!-- Jobs populated by JavaScript -->
                    </div>
                </div>
                
                <!-- On-Call Card -->
                <div class="oncall-card">
                    <div class="oncall-header">
                        <h3 class="oncall-title">ðŸš¨ Today's On-Call</h3>
                        <div class="oncall-person" id="onCallInfo">
                            <div class="avatar member-pink">LW</div>
                            <div class="member-details">
                                <h3>Lisa Wong</h3>
                                <p>Project Manager</p>
                            </div>
                            <div class="oncall-badge">On-Call</div>
                        </div>
                    </div>
                </div>
                
                <!-- Team Members -->
                <h2 style="font-size: 18px; font-weight: 700; color: var(--gray-800); margin: 16px 0 12px;">Team Members</h2>
                <div class="team-members" id="teamMembersList">
                    <!-- Team members populated by JavaScript -->
                </div>
            </div>
            
            <!-- Individual Calendar -->
            <div id="individualCalendar" class="hidden">
                <!-- Today's Jobs for Member -->
                <div class="todays-jobs-card">
                    <div class="card-header">
                        <h2 class="card-title" id="memberTodayTitle">ðŸ“‹ Today's Schedule</h2>
                        <div class="job-count-badge" id="memberJobCount">0</div>
                    </div>
                    <div class="jobs-list" id="memberTodayJobs">
                        <!-- Member's jobs populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Calendar Grid -->
                <div class="calendar-section">
                    <div class="week-days">
                        <div class="week-day">S</div>
                        <div class="week-day">M</div>
                        <div class="week-day">T</div>
                        <div class="week-day">W</div>
                        <div class="week-day">T</div>
                        <div class="week-day">F</div>
                        <div class="week-day">S</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar days populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Legend -->
        <footer class="legend">
            <h3 class="legend-title">Job Types</h3>
            <div class="legend-grid">
                <div class="legend-item job-design">Design</div>
                <div class="legend-item job-development">Development</div>
                <div class="legend-item job-testing">Testing</div>
                <div class="legend-item job-meeting">Meeting</div>
                <div class="legend-item job-review">Review</div>
                <div class="legend-item job-planning">Planning</div>
                <div class="legend-item job-on-call">On-Call</div>
            </div>
        </footer>
    </div>

    <!-- Member Selection Modal -->
    <div class="modal-overlay hidden" id="memberModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Select Team Member</h2>
                <button class="icon-button" id="closeMemberModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="member-list" id="memberList">
                    <!-- Members populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay hidden" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="icon-button" id="closeSettingsModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3 class="section-title">OneDrive Integration</h3>
                    <div class="form-group">
                        <label class="form-label" for="fileId">Excel File ID or Share Link</label>
                        <input type="text" id="fileId" class="form-input" placeholder="OneDrive file ID or share link">
                        <small class="form-help">Get this from OneDrive by sharing your Excel file</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="fileName">File Name</label>
                        <input type="text" id="fileName" class="form-input" placeholder="TeamCalendar_2024-03.xlsx">
                        <small class="form-help">Name of your Excel file in OneDrive</small>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">Preferences</h3>
                    <label class="checkbox-group">
                        <input type="checkbox" id="autoSync" class="checkbox" checked>
                        <span>Auto-sync with OneDrive</span>
                    </label>
                    <label class="checkbox-group">
                        <input type="checkbox" id="notifications" class="checkbox">
                        <span>Enable notifications</span>
                    </label>
                </div>

                <button class="secondary-button" id="testConnection">Test OneDrive Connection</button>
                <button class="primary-button" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div class="modal-overlay hidden" id="jobModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Job Details</h2>
                <button class="icon-button" id="closeJobModal">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="jobDetails">
                <!-- Job details populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // App State
        const app = {
            currentMonth: new Date(2024, 2, 1), // March 2024
            currentDate: new Date(2024, 2, 15), // Today: March 15
            selectedMember: null,
            settings: {
                fileId: '',
                fileName: 'TeamCalendar_2024-03.xlsx',
                autoSync: true,
                notifications: false
            }
        };

        // Sample Team Data
        const teamMembers = [
            { id: 1, name: 'Sarah Martinez', role: 'UI/UX Designer', color: 'member-blue', avatar: 'SM' },
            { id: 2, name: 'Alex Chen', role: 'Frontend Developer', color: 'member-green', avatar: 'AC' },
            { id: 3, name: 'Maya Patel', role: 'Backend Developer', color: 'member-purple', avatar: 'MP' },
            { id: 4, name: 'Jordan Kim', role: 'QA Engineer', color: 'member-yellow', avatar: 'JK' },
            { id: 5, name: 'Lisa Wong', role: 'Project Manager', color: 'member-pink', avatar: 'LW' },
            { id: 6, name: 'David Rodriguez', role: 'DevOps Engineer', color: 'member-orange', avatar: 'DR' }
        ];

        // Sample Job Assignments
        const jobAssignments = {
            1: { // Sarah Martinez
                3: [{ title: 'Website Mockups', type: 'design', duration: 'full', description: 'Creating wireframes and high-fidelity mockups for new website', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Mobile-first approach with accessibility focus' }],
                8: [{ title: 'Mobile App UI', type: 'design', duration: 'full', description: 'Designing mobile interface', client: 'StartupXYZ', priority: 'Medium', estimatedHours: 8, status: 'Not Started', notes: 'Research competitor apps' }],
                15: [{ title: 'Design Review', type: 'meeting', duration: 'half', description: 'Present mockups to stakeholders', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 4, status: 'Scheduled', notes: 'Prepare presentation deck' }]
            },
            2: { // Alex Chen
                1: [{ title: 'React Components', type: 'development', duration: 'full', description: 'Building dashboard components', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Data visualization focus' }],
                6: [{ title: 'API Integration', type: 'development', duration: 'full', description: 'Frontend API integration', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'Not Started', notes: 'Error handling' }],
                15: [{ title: 'Code Review', type: 'review', duration: 'half', description: 'Review team pull requests', client: 'Internal', priority: 'Medium', estimatedHours: 4, status: 'Scheduled', notes: 'Performance focus' }]
            },
            3: { // Maya Patel
                2: [{ title: 'Database Schema', type: 'development', duration: 'full', description: 'Database design updates', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'User permissions' }],
                9: [{ title: 'Performance Optimization', type: 'development', duration: 'full', description: 'Optimize queries and API', client: 'Internal', priority: 'Medium', estimatedHours: 8, status: 'Not Started', notes: '50% improvement target' }],
                15: [{ title: 'Security Review', type: 'review', duration: 'half', description: 'Security audit', client: 'Security Team', priority: 'High', estimatedHours: 4, status: 'Scheduled', notes: 'OWASP check' }]
            },
            4: { // Jordan Kim
                6: [{ title: 'Automated Testing', type: 'testing', duration: 'full', description: 'Develop test automation', client: 'Multiple', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Integration tests' }],
                13: [{ title: 'Bug Verification', type: 'testing', duration: 'half', description: 'Verify bug fixes', client: 'Various', priority: 'High', estimatedHours: 4, status: 'Not Started', notes: 'Critical path check' }],
                15: [{ title: 'Release Testing', type: 'testing', duration: 'full', description: 'Final pre-release testing', client: 'TechCorp Inc.', priority: 'High', estimatedHours: 8, status: 'Scheduled', notes: 'Smoke testing' }]
            },
            5: { // Lisa Wong
                1: [{ title: 'Sprint Planning', type: 'meeting', duration: 'half', description: 'Plan sprint goals', client: 'Dev Team', priority: 'High', estimatedHours: 3, status: 'Scheduled', notes: 'Review velocity' }],
                7: [{ title: 'Stakeholder Meeting', type: 'meeting', duration: 'half', description: 'Weekly stakeholder update', client: 'Executives', priority: 'High', estimatedHours: 2, status: 'Scheduled', notes: 'Status presentation' }],
                15: [{ title: 'On-Call Support', type: 'on-call', duration: 'full', description: 'Emergency support coverage', client: 'Operations', priority: 'High', estimatedHours: 8, status: 'Active', notes: 'Monitor production alerts' }]
            },
            6: { // David Rodriguez  
                3: [{ title: 'Infrastructure Setup', type: 'development', duration: 'full', description: 'CI/CD pipeline setup', client: 'Infrastructure', priority: 'High', estimatedHours: 8, status: 'In Progress', notes: 'Monitoring and alerts' }],
                10: [{ title: 'Performance Review', type: 'review', duration: 'half', description: 'System performance analysis', client: 'Operations', priority: 'Medium', estimatedHours: 4, status: 'Scheduled', notes: 'Resource usage analysis' }],
                15: [{ title: 'Security Patches', type: 'development', duration: 'half', description: 'Apply security updates', client: 'Security', priority: 'High', estimatedHours: 4, status: 'Scheduled', notes: 'Maintenance window' }]
            }
        };

        // Utility Functions
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        
        function getDaysInMonth(date) {
            return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
        }

        function getFirstDayOfMonth(date) {
            return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
        }

        function isToday(day) {
            return day === app.currentDate.getDate() && 
                   app.currentMonth.getMonth() === app.currentDate.getMonth() &&
                   app.currentMonth.getFullYear() === app.currentDate.getFullYear();
        }

        function isWeekend(day) {
            const date = new Date(app.currentMonth.getFullYear(), app.currentMonth.getMonth(), day);
            const dayOfWeek = date.getDay();
            return dayOfWeek === 0 || dayOfWeek === 6;
        }

        function getJobTypeClass(type) {
            return `job-${type}`;
        }

        function showToast(message, type = 'info') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            // Show animation
            setTimeout(() => toast.classList.add('show'), 100);

            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Data Functions
        function getTodaysJobs() {
            const today = app.currentDate.getDate();
            const allJobs = [];

            teamMembers.forEach(member => {
                const memberJobs = jobAssignments[member.id]?.[today] || [];
                memberJobs.forEach(job => {
                    allJobs.push({
                        ...job,
                        memberName: member.name,
                        memberAvatar: member.avatar,
                        memberColor: member.color,
                        memberId: member.id
                    });
                });
            });

            // Sort by priority then type
            return allJobs.sort((a, b) => {
                const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                const typeOrder = { 'meeting': 4, 'on-call': 3, 'development': 2, 'design': 2, 'testing': 1 };
                
                const aPriority = priorityOrder[a.priority] || 0;
                const bPriority = priorityOrder[b.priority] || 0;
                const aType = typeOrder[a.type] || 0;
                const bType = typeOrder[b.type] || 0;
                
                if (aType !== bType) return bType - aType;
                return bPriority - aPriority;
            });
        }

        function getTodaysJobsForMember(memberId) {
            const today = app.currentDate.getDate();
            const member = teamMembers.find(m => m.id === memberId);
            if (!member) return [];

            const memberJobs = jobAssignments[memberId]?.[today] || [];
            return memberJobs.map(job => ({
                ...job,
                memberName: member.name,
                memberAvatar: member.avatar,
                memberColor: member.color,
                memberId: member.id
            }));
        }

        function getNonOnCallJobCount(memberId) {
            const memberJobs = jobAssignments[memberId] || {};
            return Object.values(memberJobs)
                .flat()
                .filter(job => job.type !== 'on-call')
                .length;
        }

        function hasNonOnCallJobs(memberId, day) {
            const jobs = jobAssignments[memberId]?.[day] || [];
            return jobs.some(job => job.type !== 'on-call');
        }

        function getTodayOnCallPerson() {
            const today = app.currentDate.getDate();
            for (const member of teamMembers) {
                const memberJobs = jobAssignments[member.id]?.[today] || [];
                if (memberJobs.some(job => job.type === 'on-call')) {
                    return member;
                }
            }
            return null;
        }

        // Render Functions
        function updateMonthTitle() {
            document.getElementById('monthTitle').textContent = 
                `${monthNames[app.currentMonth.getMonth()]} ${app.currentMonth.getFullYear()}`;
        }

        function renderTodaysJobs(containerId, jobs, showMemberInfo = true) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (jobs.length === 0) {
                container.innerHTML = `
                    <div class="empty-jobs">
                        <div class="empty-jobs-icon">ðŸ“…</div>
                        <div>No jobs scheduled for today</div>
                    </div>
                `;
                return;
            }

            jobs.forEach(job => {
                const jobElement = document.createElement('div');
                jobElement.className = `job-item ${job.type === 'on-call' ? 'on-call' : ''}`;
                jobElement.onclick = () => showJobDetails(job, app.currentDate.getDate(), job.memberName);

                jobElement.innerHTML = `
                    <div class="job-content">
                        <div class="job-header">
                            <div class="job-type-badge ${getJobTypeClass(job.type)}">
                                ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                            </div>
                            <div class="priority-badge priority-${job.priority.toLowerCase()}">
                                ${job.priority}
                            </div>
                        </div>
                        
                        <div class="job-title">${job.title}</div>
                        ${showMemberInfo ? `<div class="job-member">${job.memberName}</div>` : ''}
                        <div class="job-client">${job.client}</div>
                        
                        <div class="job-duration">
                            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12,6 12,12 16,14"/>
                            </svg>
                            ${job.duration === 'full' ? 'Full Day' : 'Half Day'} (${job.estimatedHours}h)
                        </div>
                    </div>
                    ${showMemberInfo ? `<div class="avatar ${job.memberColor}">${job.memberAvatar}</div>` : ''}
                `;

                container.appendChild(jobElement);
            });
        }

        function renderTeamOverview() {
            const todaysJobs = getTodaysJobs();
            
            // Update today's jobs count
            document.getElementById('todayJobCount').textContent = todaysJobs.length;
            
            // Render today's jobs
            renderTodaysJobs('todayJobsList', todaysJobs, true);

            // Render team members
            const container = document.getElementById('teamMembersList');
            container.innerHTML = '';

            teamMembers.forEach(member => {
                const taskCount = getNonOnCallJobCount(member.id);
                const daysInMonth = getDaysInMonth(app.currentMonth);

                const card = document.createElement('div');
                card.className = 'team-card';
                card.onclick = () => selectMember(member);

                // Generate workload bar
                let workloadBar = '';
                for (let day = 1; day <= daysInMonth; day++) {
                    const hasJobs = hasNonOnCallJobs(member.id, day);
                    const weekend = isWeekend(day);
                    const today = isToday(day);
                    
                    let dayClass = 'workload-day ';
                    if (hasJobs) {
                        dayClass += member.color;
                    } else {
                        dayClass += weekend ? 'member-gray' : 'member-gray';
                    }
                    
                    workloadBar += `<div class="${dayClass}" style="background-color: ${hasJobs ? getMemberColor(member.color) : (weekend ? '#e5e7eb' : '#f3f4f6')}">${today ? '<div class="today-indicator"></div>' : ''}</div>`;
                }

                card.innerHTML = `
                    <div class="team-card-content">
                        <div class="team-info">
                            <div class="team-avatar ${member.color}">${member.avatar}</div>
                            <div class="team-details">
                                <h3>${member.name}</h3>
                                <p>${member.role}</p>
                            </div>
                        </div>
                        <div class="task-counter">
                            <div class="task-number">${taskCount}</div>
                            <div class="task-label">tasks</div>
                        </div>
                    </div>
                    <div class="workload-visualization">${workloadBar}</div>
                `;

                container.appendChild(card);
            });
        }

        function renderIndividualCalendar() {
            if (!app.selectedMember) return;

            // Update member's today jobs
            const memberTodaysJobs = getTodaysJobsForMember(app.selectedMember.id);
            document.getElementById('memberJobCount').textContent = memberTodaysJobs.length;
            document.getElementById('memberTodayTitle').textContent = `ðŸ“‹ ${app.selectedMember.name}'s Today`;
            renderTodaysJobs('memberTodayJobs', memberTodaysJobs, false);

            // Render calendar grid
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const daysInMonth = getDaysInMonth(app.currentMonth);
            const firstDay = getFirstDayOfMonth(app.currentMonth);

            // Empty cells before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day';
                grid.appendChild(emptyCell);
            }

            // Calendar days
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                let classes = 'calendar-day';
                
                if (isWeekend(day)) classes += ' weekend';
                if (isToday(day)) classes += ' today';
                
                cell.className = classes;

                // Day number
                const dayNum = document.createElement('div');
                dayNum.className = 'day-number';
                dayNum.textContent = day;
                cell.appendChild(dayNum);

                // Jobs for this day
                const jobs = jobAssignments[app.selectedMember.id]?.[day] || [];
                const jobsContainer = document.createElement('div');
                jobsContainer.className = 'day-jobs';

                jobs.slice(0, 2).forEach(job => {
                    const jobEl = document.createElement('div');
                    jobEl.className = `mini-job ${getJobTypeClass(job.type)}`;
                    jobEl.textContent = job.title;
                    jobEl.onclick = (e) => {
                        e.stopPropagation();
                        showJobDetails(job, day, app.selectedMember.name);
                    };
                    jobsContainer.appendChild(jobEl);
                });

                if (jobs.length > 2) {
                    const moreEl = document.createElement('div');
                    moreEl.className = 'more-jobs';
                    moreEl.textContent = `+${jobs.length - 2}`;
                    moreEl.onclick = (e) => {
                        e.stopPropagation();
                        showMultipleJobDetails(jobs, day, app.selectedMember.name);
                    };
                    jobsContainer.appendChild(moreEl);
                }

                cell.appendChild(jobsContainer);
                grid.appendChild(cell);
            }
        }

        function renderMemberSelection() {
            const container = document.getElementById('memberList');
            container.innerHTML = '';

            // All members option
            const allOption = document.createElement('div');
            allOption.className = `member-option ${!app.selectedMember ? 'selected' : ''}`;
            allOption.innerHTML = `
                <div class="avatar" style="background-color: var(--gray-500);">All</div>
                <div class="member-details">
                    <h3>All Team Members</h3>
                    <p>Overview Mode</p>
                </div>
            `;
            allOption.onclick = () => {
                selectMember(null);
                closeModal('memberModal');
            };
            container.appendChild(allOption);

            // Individual members
            teamMembers.forEach(member => {
                const option = document.createElement('div');
                option.className = `member-option ${app.selectedMember?.id === member.id ? 'selected' : ''}`;
                option.innerHTML = `
                    <div class="avatar ${member.color}">${member.avatar}</div>
                    <div class="member-details">
                        <h3>${member.name}</h3>
                        <p>${member.role}</p>
                    </div>
                `;
                option.onclick = () => {
                    selectMember(member);
                    closeModal('memberModal');
                };
                container.appendChild(option);
            });
        }

        function showJobDetails(job, day, memberName) {
            const container = document.getElementById('jobDetails');
            const priorityClass = `priority-${job.priority.toLowerCase()}`;
            
            container.innerHTML = `
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">
                        <strong>${memberName}</strong> - March ${day}
                    </div>
                    
                    <div class="job-type-badge ${getJobTypeClass(job.type)}" style="margin-bottom: 12px;">
                        ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                    </div>
                    
                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--gray-900);">
                        ${job.title}
                    </h3>
                    
                    <p style="color: var(--gray-700); margin-bottom: 20px; line-height: 1.5;">
                        ${job.description}
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Client:</div>
                            <div style="font-weight: 600; margin-top: 2px;">${job.client}</div>
                        </div>
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Duration:</div>
                            <div style="font-weight: 600; margin-top: 2px;">
                                ${job.duration === 'full' ? 'Full Day' : 'Half Day'} (${job.estimatedHours}h)
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Priority:</div>
                            <div class="${priorityClass}" style="font-weight: 600; margin-top: 2px;">${job.priority}</div>
                        </div>
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600;">Status:</div>
                            <div style="font-weight: 600; margin-top: 2px; color: ${getStatusColor(job.status)};">
                                ${job.status}
                            </div>
                        </div>
                    </div>
                    
                    ${job.notes ? `
                        <div>
                            <div style="color: var(--gray-500); font-size: 14px; font-weight: 600; margin-bottom: 8px;">Notes:</div>
                            <div style="background: var(--gray-50); padding: 12px; border-radius: 8px; border: 1px solid var(--gray-200); color: var(--gray-700);">
                                ${job.notes}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            showModal('jobModal');
        }

        function showMultipleJobDetails(jobs, day, memberName) {
            const container = document.getElementById('jobDetails');
            const jobsHtml = jobs.map(job => `
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 12px; margin-bottom: 12px; background: var(--white);">
                    <div class="job-type-badge ${getJobTypeClass(job.type)}" style="margin-bottom: 8px;">
                        ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                    </div>
                    <h4 style="font-weight: 600; margin-bottom: 4px;">${job.title}</h4>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 8px;">${job.description}</p>
                    <div style="font-size: 12px; color: var(--gray-500);">
                        <strong>Client:</strong> ${job.client} | 
                        <strong>Duration:</strong> ${job.duration === 'full' ? 'Full Day' : 'Half Day'} | 
                        <strong>Priority:</strong> ${job.priority}
                    </div>
                    ${job.notes ? `<div style="margin-top: 8px; padding: 8px; background: var(--gray-50); border-radius: 6px; font-size: 12px;"><strong>Notes:</strong> ${job.notes}</div>` : ''}
                </div>
            `).join('');

            container.innerHTML = `
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">
                        <strong>${memberName}</strong> - March ${day}
                    </div>
                    ${jobsHtml}
                </div>
            `;
            
            showModal('jobModal');
        }

        function getMemberColor(colorClass) {
            const colors = {
                'member-blue': '#3b82f6',
                'member-green': '#10b981',
                'member-purple': '#8b5cf6',
                'member-yellow': '#f59e0b',
                'member-pink': '#ec4899',
                'member-orange': '#f97316'
            };
            return colors[colorClass] || '#6b7280';
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Active': return 'var(--success-green)';
                case 'In Progress': return 'var(--primary-blue)';
                case 'Scheduled': return '#7c3aed';
                default: return 'var(--gray-600)';
            }
        }

        // Event Handlers
        function selectMember(member) {
            app.selectedMember = member;
            
            if (member) {
                // Show member info in header
                document.getElementById('memberInfoBar').classList.remove('hidden');
                document.getElementById('selectedAvatar').className = `avatar ${member.color}`;
                document.getElementById('selectedAvatar').textContent = member.avatar;
                document.getElementById('selectedName').textContent = member.name;
                document.getElementById('selectedRole').textContent = member.role;
                
                // Switch to individual view
                document.getElementById('teamOverview').classList.add('hidden');
                document.getElementById('individualCalendar').classList.remove('hidden');
                renderIndividualCalendar();
            } else {
                // Hide member info
                document.getElementById('memberInfoBar').classList.add('hidden');
                
                // Switch to team view
                document.getElementById('teamOverview').classList.remove('hidden');
                document.getElementById('individualCalendar').classList.add('hidden');
                renderTeamOverview();
            }
        }

        function navigateMonth(direction) {
            app.currentMonth = new Date(app.currentMonth.getFullYear(), app.currentMonth.getMonth() + direction, 1);
            updateMonthTitle();
            
            if (app.selectedMember) {
                renderIndividualCalendar();
            } else {
                renderTeamOverview();
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('.modal').classList.add('show');
            }, 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('.modal').classList.remove('show');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function saveSettings() {
            app.settings.fileId = document.getElementById('fileId').value.trim();
            app.settings.fileName = document.getElementById('fileName').value.trim();
            app.settings.autoSync = document.getElementById('autoSync').checked;
            app.settings.notifications = document.getElementById('notifications').checked;

            localStorage.setItem('teamCalendarSettings', JSON.stringify(app.settings));
            showToast('Settings saved successfully!', 'success');
            closeModal('settingsModal');
        }

        function loadSettings() {
            const saved = localStorage.getItem('teamCalendarSettings');
            if (saved) {
                try {
                    app.settings = { ...app.settings, ...JSON.parse(saved) };
                } catch (e) {
                    console.error('Failed to load settings:', e);
                }
            }

            // Update form
            document.getElementById('fileId').value = app.settings.fileId;
            document.getElementById('fileName').value = app.settings.fileName;
            document.getElementById('autoSync').checked = app.settings.autoSync;
            document.getElementById('notifications').checked = app.settings.notifications;
        }

        async function testConnection() {
            const button = document.getElementById('testConnection');
            button.innerHTML = 'Testing... <span class="spinner"></span>';
            button.disabled = true;

            try {
                // Simulate connection test
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                if (app.settings.fileId && app.settings.fileName) {
                    showToast('OneDrive connection successful!', 'success');
                } else {
                    showToast('Please configure file settings first', 'error');
                }
            } catch (error) {
                showToast('Connection failed: ' + error.message, 'error');
            } finally {
                button.innerHTML = 'Test OneDrive Connection';
                button.disabled = false;
            }
        }

        // Event Listeners
        document.getElementById('menuButton').onclick = () => showModal('memberModal');
        document.getElementById('prevButton').onclick = () => navigateMonth(-1);
        document.getElementById('nextButton').onclick = () => navigateMonth(1);
        document.getElementById('settingsButton').onclick = () => showModal('settingsModal');
        
        document.getElementById('closeMemberModal').onclick = () => closeModal('memberModal');
        document.getElementById('closeSettingsModal').onclick = () => closeModal('settingsModal');
        document.getElementById('closeJobModal').onclick = () => closeModal('jobModal');
        
        document.getElementById('saveSettings').onclick = saveSettings;
        document.getElementById('testConnection').onclick = testConnection;

        // Close modals on overlay click
        ['memberModal', 'settingsModal', 'jobModal'].forEach(modalId => {
            document.getElementById(modalId).onclick = (e) => {
                if (e.target.id === modalId) {
                    closeModal(modalId);
                }
            };
        });

        // Initialize App
        function initializeApp() {
            loadSettings();
            updateMonthTitle();
            renderTeamOverview();
            renderMemberSelection();
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'team-calendar-v2';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                    
                    self.addEventListener('activate', event => {
                        event.waitUntil(self.clients.claim());
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(() => {
                        console.log('PWA Service Worker registered');
                        showToast('Team Calendar ready for offline use!', 'success');
                    })
                    .catch(err => console.log('Service Worker registration failed:', err));
            }

            // Show welcome message
            setTimeout(() => {
                showToast('Welcome to Team Calendar! Tap the gear icon to configure OneDrive.', 'info');
            }, 1500);
        }

        // Start app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // PWA Installation Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Could show custom install button here
            console.log('PWA install available');
        });

        window.addEventListener('appinstalled', () => {
            showToast('Team Calendar installed successfully!', 'success');
            deferredPrompt = null;
        });
    </script>
</body>
</html>