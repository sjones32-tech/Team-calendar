<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Team Calendar</title>
    <meta name="description" content="Professional team resource calendar with Excel integration">
    <meta name="theme-color" content="#3b82f6">

```
<!-- PWA Configuration -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Team Calendar">

<!-- PWA Manifest -->
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGVhbSBDYWxlbmRhciIsInNob3J0X25hbWUiOiJUZWFtQ2FsIiwiZGVzY3JpcHRpb24iOiJQcm9mZXNzaW9uYWwgdGVhbSByZXNvdXJjZSBjYWxlbmRhciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjM2I4MmY2Iiwib3JpZW50YXRpb24iOiJwb3J0cmFpdCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlTU0l3SURBZ01qVTJJREkxTmlKZ1ptbHNiRDBpSXpNeU9EZG1OaUkrUEhKbFkzUWdlRDBpTkRnaUlIazlJalE0SWlCM2FXUjBhRDBpTVRZd0lpQm9aV2xuYUhROUlqRTJNQ0lnWm1sc2JEMGlJelEzT0RBME1DSXZQand2YzNabmZqND0iLCJzaXplcyI6IjI1NngyNTYiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">

<!-- Icons -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTYgMjU2IiBmaWxsPSIjMzI4N2Y2Ij48cmVjdCB4PSI0OCIgeT0iNDgiIHdpZHRoPSIxNjAiIGhlaWdodD0iMTYwIiBmaWxsPSIjNDcwNDAiLz48L3N2Zz4=">

<!-- External Libraries for Excel Parsing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    /* CSS Variables */
    :root {
        --primary-blue: #3b82f6;
        --primary-hover: #2563eb;
        --success-green: #10b981;
        --warning-orange: #f59e0b;
        --error-red: #ef4444;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-500: #6b7280;
        --gray-700: #374151;
        --gray-900: #111827;
        --white: #ffffff;
        --border-radius: 8px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        background-color: var(--gray-50);
        color: var(--gray-900);
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
    }

    .app-container {
        max-width: 428px;
        margin: 0 auto;
        min-height: 100vh;
        background: var(--white);
        box-shadow: var(--shadow-lg);
    }

    /* Header */
    .app-header {
        background: var(--white);
        padding: 16px;
        border-bottom: 1px solid var(--gray-200);
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
    }

    .header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .icon-button {
        background: none;
        border: none;
        padding: 10px;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-button:hover {
        background-color: var(--gray-100);
    }

    .month-nav {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .month-title {
        font-size: 18px;
        font-weight: 600;
        min-width: 160px;
        text-align: center;
    }

    /* Status Indicator */
    .status-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 8px;
        border-top: 1px solid var(--gray-200);
        font-size: 12px;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .status-loading { background: var(--warning-orange); }
    .status-connected { background: var(--success-green); }
    .status-error { background: var(--error-red); }
    .status-local { background: var(--gray-500); }

    /* Content */
    .main-content {
        padding: 16px;
        min-height: calc(100vh - 180px);
    }

    .loading-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 20px;
        text-align: center;
    }

    .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid var(--gray-200);
        border-top: 3px solid var(--primary-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Today's Jobs Card */
    .todays-jobs {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        margin-bottom: 16px;
        box-shadow: var(--shadow);
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        border-bottom: 1px solid var(--gray-100);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: var(--white);
        border-radius: 12px 12px 0 0;
    }

    .card-title {
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .job-count-badge {
        background: rgba(255, 255, 255, 0.2);
        color: var(--white);
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .jobs-container {
        padding: 12px 16px 16px;
        max-height: 300px;
        overflow-y: auto;
    }

    .job-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border: 1px solid var(--gray-200);
        border-radius: var(--border-radius);
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: var(--white);
    }

    .job-item:hover {
        background: var(--gray-50);
        transform: translateY(-1px);
        box-shadow: var(--shadow);
    }

    .job-item:active {
        transform: scale(0.98);
    }

    .job-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 12px;
        font-weight: 700;
        flex-shrink: 0;
    }

    .job-details {
        flex: 1;
        min-width: 0;
    }

    .job-header {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 4px;
        flex-wrap: wrap;
    }

    .job-type-badge {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        border: 1px solid;
    }

    .priority-high { background: #fef2f2; color: #dc2626; border-color: #fca5a5; }
    .priority-medium { background: #fef3c7; color: #d97706; border-color: #fde047; }
    .priority-low { background: #ecfdf5; color: #059669; border-color: #86efac; }

    .job-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 2px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .job-meta {
        font-size: 11px;
        color: var(--gray-500);
    }

    /* Job Type Colors */
    .job-design { background: #dbeafe; color: #1e40af; border-color: #93c5fd; }
    .job-development { background: #dcfce7; color: #166534; border-color: #86efac; }
    .job-testing { background: #fef3c7; color: #92400e; border-color: #fde047; }
    .job-meeting { background: #e9d5ff; color: #7c3aed; border-color: #c4b5fd; }
    .job-review { background: #fed7aa; color: #c2410c; border-color: #fdba74; }
    .job-planning { background: #fce7f3; color: #be185d; border-color: #f9a8d4; }
    .job-on-call { background: #fee2e2; color: #dc2626; border-color: #fca5a5; }

    /* Member Colors */
    .member-blue { background-color: var(--primary-blue); }
    .member-green { background-color: var(--success-green); }
    .member-purple { background-color: #8b5cf6; }
    .member-yellow { background-color: var(--warning-orange); }
    .member-pink { background-color: #ec4899; }
    .member-orange { background-color: #f97316; }

    /* Team Cards */
    .team-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .team-card {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: var(--shadow);
    }

    .team-card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-1px);
    }

    .team-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .member-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .team-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 14px;
        font-weight: 700;
    }

    .member-text h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 2px;
    }

    .member-text p {
        font-size: 12px;
        color: var(--gray-500);
    }

    .task-count {
        text-align: right;
    }

    .task-number {
        font-size: 24px;
        font-weight: 700;
        color: var(--gray-700);
    }

    .task-label {
        font-size: 12px;
        color: var(--gray-500);
    }

    /* Error and Empty States */
    .error-state {
        text-align: center;
        padding: 40px 20px;
        background: #fef2f2;
        border: 1px solid #fca5a5;
        border-radius: 12px;
        margin: 16px 0;
    }

    .error-icon {
        font-size: 32px;
        margin-bottom: 12px;
    }

    .error-title {
        font-size: 16px;
        font-weight: 600;
        color: #dc2626;
        margin-bottom: 8px;
    }

    .error-message {
        font-size: 14px;
        color: #991b1b;
        margin-bottom: 16px;
    }

    .retry-button {
        background: #dc2626;
        color: var(--white);
        border: none;
        padding: 8px 16px;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
    }

    .empty-state {
        text-align: center;
        padding: 32px 16px;
        color: var(--gray-500);
    }

    /* Debug Panel */
    .debug-panel {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: var(--border-radius);
        padding: 12px;
        margin: 16px 0;
        font-size: 12px;
    }

    .debug-title {
        font-weight: 600;
        margin-bottom: 8px;
        color: #0369a1;
    }

    .debug-info {
        background: var(--white);
        padding: 8px;
        border-radius: 4px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
    }

    /* Modals */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
    }

    .modal {
        background: var(--white);
        border-radius: 12px;
        max-width: 400px;
        width: 100%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
    }

    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
        border-radius: 12px 12px 0 0;
    }

    .modal-title {
        font-size: 18px;
        font-weight: 600;
    }

    .modal-body {
        padding: 16px;
    }

    /* Settings */
    .form-group {
        margin-bottom: 16px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--gray-700);
    }

    .form-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--gray-300);
        border-radius: var(--border-radius);
        font-size: 14px;
        transition: border-color 0.2s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-help {
        font-size: 12px;
        color: var(--gray-500);
        margin-top: 4px;
    }

    .primary-button {
        width: 100%;
        padding: 12px;
        background: var(--primary-blue);
        color: var(--white);
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-bottom: 8px;
    }

    .primary-button:hover {
        background: var(--primary-hover);
    }

    .primary-button:disabled {
        background: var(--gray-300);
        cursor: not-allowed;
    }

    /* Toast */
    .toast {
        position: fixed;
        top: 20px;
        left: 16px;
        right: 16px;
        max-width: 400px;
        margin: 0 auto;
        padding: 12px 16px;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 600;
        z-index: 2000;
        transform: translateY(-100px);
        transition: transform 0.3s ease;
    }

    .toast.show {
        transform: translateY(0);
    }

    .toast-success { background: var(--success-green); color: var(--white); }
    .toast-error { background: var(--error-red); color: var(--white); }
    .toast-info { background: var(--primary-blue); color: var(--white); }

    .hidden { display: none !important; }
</style>
```

</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-row">
                <button class="icon-button" id="refreshButton" title="Refresh Data">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M1 4v6h6M23 20v-6h-6"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                </button>

```
            <div class="month-nav">
                <button class="icon-button" id="prevButton">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
                <h1 class="month-title" id="monthTitle">April 2024</h1>
                <button class="icon-button" id="nextButton">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>
            
            <button class="icon-button" id="settingsButton" title="Settings">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>
        </div>
        
        <div class="status-bar" id="statusBar">
            <div class="status-dot status-local" id="statusDot"></div>
            <span id="statusText">Using sample data</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="loading-screen hidden">
            <div class="spinner"></div>
            <h3>Loading Excel Data...</h3>
            <p style="color: var(--gray-500); margin-top: 8px;">Connecting to OneDrive</p>
        </div>

        <!-- Error Screen -->
        <div id="errorScreen" class="error-state hidden">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h3 class="error-title">Failed to Load Excel Data</h3>
            <p class="error-message" id="errorMessage">Could not load data from OneDrive</p>
            <button class="retry-button" id="retryButton">Try Again</button>
            <button class="primary-button" style="margin-top: 8px;" id="useSampleButton">Use Sample Data</button>
        </div>

        <!-- Main App -->
        <div id="mainApp">
            <!-- Today's Jobs -->
            <div class="todays-jobs">
                <div class="card-header">
                    <h2 class="card-title">
                        üìÖ Today's Scheduled Jobs
                    </h2>
                    <div class="job-count-badge" id="todayJobCount">0</div>
                </div>
                <div class="jobs-container" id="todayJobsList">
                    <div class="empty-state">
                        <div style="font-size: 24px; margin-bottom: 8px;">üìã</div>
                        <div>No jobs scheduled for today</div>
                    </div>
                </div>
            </div>

            <!-- On-Call Display -->
            <div class="todays-jobs">
                <div class="card-header">
                    <h2 class="card-title">üö® Today's On-Call</h2>
                </div>
                <div class="jobs-container" id="onCallDisplay">
                    <div class="empty-state">No one assigned</div>
                </div>
            </div>

            <!-- Team Members -->
            <h2 style="font-size: 18px; font-weight: 700; margin: 16px 0 12px;">Team Members</h2>
            <div class="team-list" id="teamList">
                <!-- Team members populated by JavaScript -->
            </div>

            <!-- Debug Panel -->
            <div class="debug-panel" id="debugPanel" style="display: none;">
                <div class="debug-title">üîç Debug Information</div>
                <div class="debug-info" id="debugInfo">
                    Excel loading status and data parsing details will appear here...
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Settings Modal -->
<div class="modal-overlay hidden" id="settingsModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title">Settings & Debug</h2>
            <button class="icon-button" id="closeSettings">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">OneDrive File Share Link</label>
                <input type="text" id="shareLink" class="form-input" placeholder="https://yourcompany-my.sharepoint.com/...">
                <small class="form-help">Paste your OneDrive Excel file share link</small>
            </div>

            <div class="form-group">
                <label class="form-label">File Name</label>
                <input type="text" id="fileName" class="form-input" value="TeamCalendar_2024-04.xlsx">
                <small class="form-help">Name of your Excel file</small>
            </div>

            <button class="primary-button" id="testExcel">Test Excel Connection</button>
            <button class="primary-button" id="loadExcelData">Load Excel Data</button>
            <button class="primary-button" id="toggleDebug">Toggle Debug Mode</button>
            <button class="primary-button" id="saveSettings">Save Settings</button>
            
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--gray-200);">
                <h4 style="margin-bottom: 8px;">Quick Actions:</h4>
                <button class="primary-button" id="useSample">Use Sample Data</button>
                <button class="primary-button" id="clearCache">Clear Cache & Restart</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Global App State
    const app = {
        currentMonth: new Date(2024, 3, 1), // April 2024
        currentDate: new Date(2024, 3, 12), // April 12, 2024
        teamMembers: [],
        jobAssignments: {},
        dataSource: 'sample', // 'sample', 'excel', or 'error'
        debugMode: false,
        settings: {
            shareLink: '',
            fileName: 'TeamCalendar_2024-04.xlsx',
            lastSync: null
        }
    };

    // Sample Data (Fallback)
    const sampleData = {
        teamMembers: [
            { id: 1, name: 'Sarah Martinez', role: 'UI/UX Designer', color: 'member-blue', avatar: 'SM' },
            { id: 2, name: 'Alex Chen', role: 'Frontend Developer', color: 'member-green', avatar: 'AC' },
            { id: 3, name: 'Maya Patel', role: 'Backend Developer', color: 'member-purple', avatar: 'MP' },
            { id: 4, name: 'Jordan Kim', role: 'QA Engineer', color: 'member-yellow', avatar: 'JK' },
            { id: 5, name: 'Lisa Wong', role: 'Project Manager', color: 'member-pink', avatar: 'LW' },
            { id: 6, name: 'David Rodriguez', role: 'DevOps Engineer', color: 'member-orange', avatar: 'DR' }
        ],
        jobAssignments: {
            1: {
                12: [{
                    title: 'Client Presentation',
                    type: 'meeting',
                    duration: 'half',
                    description: 'Present Q1 design deliverables to stakeholders',
                    client: 'TechCorp Inc.',
                    priority: 'High',
                    estimatedHours: 4,
                    status: 'Scheduled',
                    notes: 'Prepare comprehensive design portfolio'
                }]
            },
            2: {
                12: [{
                    title: 'Feature Development',
                    type: 'development',
                    duration: 'full',
                    description: 'Implement new dashboard features',
                    client: 'TechCorp Inc.',
                    priority: 'High',
                    estimatedHours: 8,
                    status: 'In Progress',
                    notes: 'Priority on data visualization'
                }]
            },
            3: {
                12: [{
                    title: 'API Security Audit',
                    type: 'review',
                    duration: 'half',
                    description: 'Security audit of API endpoints',
                    client: 'Security Team',
                    priority: 'High',
                    estimatedHours: 4,
                    status: 'Scheduled',
                    notes: 'Check OWASP vulnerabilities'
                }]
            },
            4: {
                12: [{
                    title: 'QA Review',
                    type: 'review',
                    duration: 'half',
                    description: 'Review QA processes',
                    client: 'Internal',
                    priority: 'Medium',
                    estimatedHours: 4,
                    status: 'Scheduled',
                    notes: 'Focus on test coverage'
                }]
            },
            5: {
                12: [{
                    title: 'On-Call Support',
                    type: 'on-call',
                    duration: 'full',
                    description: 'Emergency support coverage',
                    client: 'Operations',
                    priority: 'High',
                    estimatedHours: 8,
                    status: 'Active',
                    notes: 'Monitor production alerts'
                }]
            },
            6: {
                12: [{
                    title: 'System Monitoring',
                    type: 'review',
                    duration: 'half',
                    description: 'Review system performance',
                    client: 'Operations',
                    priority: 'Medium',
                    estimatedHours: 4,
                    status: 'Scheduled',
                    notes: 'Analyze alert patterns'
                }]
            }
        }
    };

    // Excel Integration Functions
    async function loadExcelData() {
        updateStatus('loading', 'Loading Excel data...');
        document.getElementById('loadingScreen').classList.remove('hidden');
        document.getElementById('mainApp').classList.add('hidden');
        document.getElementById('errorScreen').classList.add('hidden');

        try {
            debugLog('Starting Excel data load...');
            
            if (!app.settings.shareLink) {
                throw new Error('No OneDrive share link configured. Please add in Settings.');
            }

            // Extract file ID from OneDrive share link
            const fileId = extractFileIdFromShareLink(app.settings.shareLink);
            debugLog('Extracted file ID:', fileId);

            // Simulate Excel API call (replace with real Microsoft Graph call)
            debugLog('Attempting to fetch Excel file...');
            
            // This would be the real Microsoft Graph API call:
            // const response = await fetch(`https://graph.microsoft.com/v1.0/me/drive/items/${fileId}/workbook/worksheets`);
            
            // For now, simulate the call
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Simulate success or failure based on settings
            if (fileId && fileId.length > 10) {
                debugLog('Excel file accessed successfully');
                
                // Parse Excel data (simulated)
                const excelData = await parseExcelData(fileId);
                
                // Update app data
                app.teamMembers = excelData.teamMembers;
                app.jobAssignments = excelData.jobAssignments;
                app.dataSource = 'excel';
                
                updateStatus('connected', 'Excel data loaded successfully');
                showToast('Excel data loaded from OneDrive!', 'success');
                
                debugLog('Data loaded successfully:', {
                    teamMembers: app.teamMembers.length,
                    jobCount: Object.keys(app.jobAssignments).length
                });
                
            } else {
                throw new Error('Invalid OneDrive share link format');
            }
            
        } catch (error) {
            debugLog('Excel loading failed:', error.message);
            showError(error.message);
            return;
        }

        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        renderApp();
    }

    async function parseExcelData(fileId) {
        debugLog('Parsing Excel worksheets...');
        
        // This simulates parsing the actual Excel file
        // In production, this would use Microsoft Graph API to read worksheets
        
        // For demonstration, return enhanced sample data that matches Excel structure
        return {
            teamMembers: [
                { id: 1, name: 'Sarah Martinez', role: 'UI/UX Designer', color: 'member-blue', avatar: 'SM' },
                { id: 2, name: 'Alex Chen', role: 'Frontend Developer', color: 'member-green', avatar: 'AC' },
                { id: 3, name: 'Maya Patel', role: 'Backend Developer', color: 'member-purple', avatar: 'MP' },
                { id: 4, name: 'Jordan Kim', role: 'QA Engineer', color: 'member-yellow', avatar: 'JK' },
                { id: 5, name: 'Lisa Wong', role: 'Project Manager', color: 'member-pink', avatar: 'LW' },
                { id: 6, name: 'David Rodriguez', role: 'DevOps Engineer', color: 'member-orange', avatar: 'DR' }
            ],
            jobAssignments: {
                1: {
                    5: [{
                        title: 'Brand Guidelines',
                        type: 'design',
                        duration: 'full',
                        description: 'Developing comprehensive brand identity guidelines',
                        client: 'GreenTech Solutions',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'Not Started',
                        notes: 'Include logo usage and color palette specifications'
                    }],
                    12: [{
                        title: 'Client Presentation',
                        type: 'meeting',
                        duration: 'half',
                        description: 'Present Q1 design deliverables to stakeholders',
                        client: 'TechCorp Inc.',
                        priority: 'High',
                        estimatedHours: 4,
                        status: 'Scheduled',
                        notes: 'Prepare comprehensive design portfolio'
                    }],
                    18: [{
                        title: 'Mobile App Prototype',
                        type: 'design',
                        duration: 'full',
                        description: 'Create interactive prototype for mobile application',
                        client: 'StartupXYZ',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'Not Started',
                        notes: 'Include user flow diagrams'
                    }]
                },
                2: {
                    2: [{
                        title: 'Frontend Architecture',
                        type: 'development',
                        duration: 'full',
                        description: 'Design and implement new frontend architecture',
                        client: 'TechCorp Inc.',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'Not Started',
                        notes: 'Focus on scalability'
                    }],
                    12: [{
                        title: 'Feature Development',
                        type: 'development',
                        duration: 'full',
                        description: 'Implement new dashboard features',
                        client: 'TechCorp Inc.',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'In Progress',
                        notes: 'Priority on data visualization'
                    }]
                },
                3: {
                    3: [{
                        title: 'Microservices Architecture',
                        type: 'development',
                        duration: 'full',
                        description: 'Design microservices for scalability',
                        client: 'TechCorp Inc.',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'In Progress',
                        notes: 'Service communication focus'
                    }],
                    12: [{
                        title: 'API Security Audit',
                        type: 'review',
                        duration: 'half',
                        description: 'Security audit of API endpoints',
                        client: 'Security Team',
                        priority: 'High',
                        estimatedHours: 4,
                        status: 'Scheduled',
                        notes: 'Check OWASP vulnerabilities'
                    }]
                },
                4: {
                    4: [{
                        title: 'Test Automation',
                        type: 'testing',
                        duration: 'full',
                        description: 'Build automated testing framework',
                        client: 'Multiple Projects',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'In Progress',
                        notes: 'Cross-browser testing'
                    }],
                    12: [{
                        title: 'QA Review',
                        type: 'review',
                        duration: 'half',
                        description: 'Review QA processes',
                        client: 'Internal',
                        priority: 'Medium',
                        estimatedHours: 4,
                        status: 'Scheduled',
                        notes: 'Test coverage metrics'
                    }]
                },
                5: {
                    1: [{
                        title: 'Q2 Planning',
                        type: 'planning',
                        duration: 'full',
                        description: 'Strategic planning for Q2',
                        client: 'Executive Team',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'Not Started',
                        notes: 'Budget and timeline development'
                    }],
                    12: [{
                        title: 'On-Call Support',
                        type: 'on-call',
                        duration: 'full',
                        description: 'Emergency support coverage',
                        client: 'Operations',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'Active',
                        notes: 'Monitor production systems'
                    }]
                },
                6: {
                    3: [{
                        title: 'Cloud Infrastructure',
                        type: 'development',
                        duration: 'full',
                        description: 'Set up cloud infrastructure',
                        client: 'Infrastructure Team',
                        priority: 'High',
                        estimatedHours: 8,
                        status: 'In Progress',
                        notes: 'Auto-scaling setup'
                    }],
                    12: [{
                        title: 'System Monitoring',
                        type: 'review',
                        duration: 'half',
                        description: 'Review system performance',
                        client: 'Operations',
                        priority: 'Medium',
                        estimatedHours: 4,
                        status: 'Scheduled',
                        notes: 'Analyze alert patterns'
                    }]
                }
            }
        };
    }

    // Utility Functions
    function extractFileIdFromShareLink(shareLink) {
        try {
            // Extract file ID from various OneDrive share link formats
            if (shareLink.includes('/personal/')) {
                const match = shareLink.match(/\/([A-Za-z0-9_-]{20,})/);
                return match ? match[1] : null;
            } else if (shareLink.includes(':x:')) {
                const match = shareLink.match(/:x:.*?\/([A-Za-z0-9_-]{20,})/);
                return match ? match[1] : null;
            } else {
                // Try to extract any long alphanumeric string
                const match = shareLink.match(/([A-Za-z0-9_-]{20,})/);
                return match ? match[1] : shareLink;
            }
        } catch (error) {
            debugLog('Error extracting file ID:', error);
            return shareLink;
        }
    }

    function updateStatus(type, message) {
        const dot = document.getElementById('statusDot');
        const text = document.getElementById('statusText');
        
        dot.className = `status-dot status-${type}`;
        text.textContent = message;
    }

    function showError(message) {
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.add('hidden');
        document.getElementById('errorScreen').classList.remove('hidden');
        document.getElementById('errorMessage').textContent = message;
        
        updateStatus('error', 'Excel loading failed');
        debugLog('Error displayed:', message);
    }

    function showToast(message, type = 'info') {
        const existingToasts = document.querySelectorAll('.toast');
        existingToasts.forEach(toast => toast.remove());

        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    function debugLog(message, data = null) {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;
        
        console.log(logEntry, data || '');
        
        if (app.debugMode) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.textContent += logEntry + (data ? '\n' + JSON.stringify(data, null, 2) : '') + '\n\n';
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
    }

    // Data Loading Functions
    function useSampleData() {
        debugLog('Loading sample data...');
        
        app.teamMembers = sampleData.teamMembers;
        app.jobAssignments = sampleData.jobAssignments;
        app.dataSource = 'sample';
        
        updateStatus('local', 'Using sample data');
        
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('errorScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        
        renderApp();
        showToast('Sample data loaded successfully', 'info');
        
        debugLog('Sample data loaded:', {
            teamMembers: app.teamMembers.length,
            jobAssignments: Object.keys(app.jobAssignments).length
        });
    }

    function getTodaysJobs() {
        const today = app.currentDate.getDate();
        const allJobs = [];

        for (const memberId in app.jobAssignments) {
            const memberJobs = app.jobAssignments[memberId]?.[today] || [];
            const member = app.teamMembers.find(m => m.id === parseInt(memberId));
            
            if (member) {
                memberJobs.forEach(job => {
                    allJobs.push({
                        ...job,
                        memberName: member.name,
                        memberAvatar: member.avatar,
                        memberColor: member.color,
                        memberId: member.id
                    });
                });
            }
        }

        // Sort by priority
        return allJobs.sort((a, b) => {
            const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
            return (priorityOrder[b.priority] || 0) - (priorityOrder[a.priority] || 0);
        });
    }

    function getTodayOnCallPerson() {
        const today = app.currentDate.getDate();
        
        for (const member of app.teamMembers) {
            const memberJobs = app.jobAssignments[member.id]?.[today] || [];
            if (memberJobs.some(job => job.type === 'on-call')) {
                return member;
            }
        }
        return null;
    }

    // Render Functions
    function renderTodaysJobs() {
        const jobs = getTodaysJobs();
        const container = document.getElementById('todayJobsList');
        const countBadge = document.getElementById('todayJobCount');

        countBadge.textContent = jobs.length;

        if (jobs.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div style="font-size: 24px; margin-bottom: 8px;">üìã</div>
                    <div>No jobs scheduled for today</div>
                </div>
            `;
            return;
        }

        container.innerHTML = '';

        jobs.forEach(job => {
            const jobEl = document.createElement('div');
            jobEl.className = 'job-item';
            
            jobEl.innerHTML = `
                <div class="job-avatar ${job.memberColor}">${job.memberAvatar}</div>
                <div class="job-details">
                    <div class="job-header">
                        <div class="job-type-badge job-${job.type}">
                            ${job.type.charAt(0).toUpperCase() + job.type.slice(1)}
                        </div>
                        <div class="priority-badge priority-${job.priority.toLowerCase()}">
                            ${job.priority}
                        </div>
                    </div>
                    <div class="job-title">${job.title}</div>
                    <div class="job-meta">${job.memberName} ‚Ä¢ ${job.client}</div>
                    <div class="job-meta">
                        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                        ${job.duration === 'full' ? 'Full Day' : 'Half Day'} (${job.estimatedHours}h)
                    </div>
                </div>
            `;
            
            container.appendChild(jobEl);
        });
    }

    function renderOnCall() {
        const onCallPerson = getTodayOnCallPerson();
        const container = document.getElementById('onCallDisplay');

        if (onCallPerson) {
            container.innerHTML = `
                <div class="job-item" style="border: none; background: #fef2f2;">
                    <div class="job-avatar ${onCallPerson.color}">${onCallPerson.avatar}</div>
                    <div class="job-details">
                        <div class="job-title">${onCallPerson.name}</div>
                        <div class="job-meta">${onCallPerson.role}</div>
                        <div class="job-meta" style="color: #dc2626; font-weight: 600;">
                            üö® Available for emergency support
                        </div>
                    </div>
                </div>
            `;
        } else {
            container.innerHTML = `
                <div class="empty-state">
                    <div>No one assigned</div>
                </div>
            `;
        }
    }

    function renderTeamList() {
        const container = document.getElementById('teamList');
        container.innerHTML = '';

        app.teamMembers.forEach(member => {
            const taskCount = Object.values(app.jobAssignments[member.id] || {})
                .flat()
                .filter(job => job.type !== 'on-call')
                .length;

            const card = document.createElement('div');
            card.className = 'team-card';
            
            card.innerHTML = `
                <div class="team-header">
                    <div class="member-info">
                        <div class="team-avatar ${member.color}">${member.avatar}</div>
                        <div class="member-text">
                            <h3>${member.name}</h3>
                            <p>${member.role}</p>
                        </div>
                    </div>
                    <div class="task-count">
                        <div class="task-number">${taskCount}</div>
                        <div class="task-label">tasks</div>
                    </div>
                </div>
            `;

            container.appendChild(card);
        });
    }

    function renderApp() {
        debugLog('Rendering app with current data...');
        renderTodaysJobs();
        renderOnCall();
        renderTeamList();
        debugLog('App render complete');
    }

    // Settings Functions
    function loadSettings() {
        const saved = localStorage.getItem('teamCalendarSettings');
        if (saved) {
            try {
                app.settings = { ...app.settings, ...JSON.parse(saved) };
                debugLog('Settings loaded from localStorage');
            } catch (e) {
                debugLog('Failed to load settings:', e.message);
            }
        }

        // Update form
        document.getElementById('shareLink').value = app.settings.shareLink;
        document.getElementById('fileName').value = app.settings.fileName;
    }

    function saveSettings() {
        app.settings.shareLink = document.getElementById('shareLink').value.trim();
        app.settings.fileName = document.getElementById('fileName').value.trim();

        localStorage.setItem('teamCalendarSettings', JSON.stringify(app.settings));
        showToast('Settings saved successfully!', 'success');
        closeModal('settingsModal');
        
        debugLog('Settings saved:', app.settings);
    }

    // Event Handlers
    function openSettings() {
        document.getElementById('settingsModal').classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    function toggleDebug() {
        app.debugMode = !app.debugMode;
        const panel = document.getElementById('debugPanel');
        panel.style.display = app.debugMode ? 'block' : 'none';
        
        if (app.debugMode) {
            debugLog('Debug mode enabled');
            showToast('Debug mode enabled', 'info');
        } else {
            showToast('Debug mode disabled', 'info');
        }
    }

    async function testExcelConnection() {
        if (!app.settings.shareLink) {
            showToast('Please enter OneDrive share link first', 'error');
            return;
        }

        const button = document.getElementById('testExcel');
        button.disabled = true;
        button.textContent = 'Testing...';

        try {
            debugLog('Testing Excel connection...');
            debugLog('Share link:', app.settings.shareLink);
            
            const fileId = extractFileIdFromShareLink(app.settings.shareLink);
            debugLog('Extracted file ID:', fileId);

            // Simulate connection test
            await new Promise(resolve => setTimeout(resolve, 1500));

            if (fileId && fileId.length > 5) {
                showToast('OneDrive connection successful!', 'success');
                debugLog('Connection test passed');
            } else {
                throw new Error('Invalid share link format');
            }
        } catch (error) {
            showToast('Connection test failed: ' + error.message, 'error');
            debugLog('Connection test failed:', error.message);
        } finally {
            button.disabled = false;
            button.textContent = 'Test Excel Connection';
        }
    }

    function clearCacheAndRestart() {
        localStorage.clear();
        showToast('Cache cleared. Restarting...', 'info');
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }

    // Event Listeners
    document.getElementById('settingsButton').onclick = openSettings;
    document.getElementById('closeSettings').onclick = () => closeModal('settingsModal');
    document.getElementById('saveSettings').onclick = saveSettings;
    document.getElementById('testExcel').onclick = testExcelConnection;
    document.getElementById('loadExcelData').onclick = loadExcelData;
    document.getElementById('useSample').onclick = useSampleData;
    document.getElementById('useSampleButton').onclick = useSampleData;
    document.getElementById('retryButton').onclick = loadExcelData;
    document.getElementById('toggleDebug').onclick = toggleDebug;
    document.getElementById('refreshButton').onclick = () => {
        if (app.settings.shareLink) {
            loadExcelData();
        } else {
            showToast('Configure OneDrive settings first', 'info');
            openSettings();
        }
    };
    document.getElementById('clearCache').onclick = clearCacheAndRestart;

    // Close modal on overlay click
    document.getElementById('settingsModal').onclick = (e) => {
        if (e.target.id === 'settingsModal') closeModal('settingsModal');
    };

    // Initialize App
    function initApp() {
        debugLog('Initializing Team Calendar PWA...');
        loadSettings();
        
        // Check if we have Excel settings
        if (app.settings.shareLink) {
            debugLog('OneDrive settings found, attempting to load Excel data...');
            loadExcelData();
        } else {
            debugLog('No OneDrive settings, using sample data...');
            useSampleData();
            showToast('Configure OneDrive in Settings for real data', 'info');
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'team-calendar-v3';
                self.addEventListener('install', () => self.skipWaiting());
                self.addEventListener('activate', () => self.clients.claim());
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(() => debugLog('Service worker registered'))
                .catch(err => debugLog('Service worker failed:', err.message));
        }
    }

    // Start app
    document.addEventListener('DOMContentLoaded', initApp);
</script>
```

</body>
</html>